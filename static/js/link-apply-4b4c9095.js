import{_ as E,al as F,J as U,A as c,K as f,H as I,ap as p,S as u,aE as y,aF as R,c as B,b as l,a as b,e as i,F as N,am as j,aG as q,o as A,I as H,t as O,aH as z}from"./index-9c00c9ce.js";import{E as C,a as S}from"./el-form-item-1a81592f.js";import{_ as T}from"./index-e6d92354.js";import{u as D,a as G}from"./links-d6166a20.js";import{i as J}from"./user-e42289b4.js";import{U as K}from"./upload-937f8326.js";import"./castArray-7df2df44.js";import"./el-dropdown-0230fa9d.js";import"./el-scrollbar-9357c77b.js";import"./el-image-viewer-623ed655.js";import"./index-3cf87c02.js";const M={class:"center_box flex justify-center flex-col items-center"},P={class:"pos"},$={__name:"link-apply",setup(Q){const{getUserInfo:_}=F(U()),w=(a,t,s)=>{if(t){if(t.indexOf("http")==-1)return s(new Error("请输入带http://或https://的网站地址"));s()}else return s(new Error("请输入网站地址"))},r=c(!1),g=j(),m=c(""),v=c(),e=f({site_name:"",site_desc:"",url:"",site_avatar:"",bgList:[],status:1,user_id:""}),h=f({...e}),x=f({site_name:[{required:!0,message:"请输入网站名称",trigger:"blur"}],site_desc:[{required:!0,message:"请输入网站描述",trigger:"blur"}],url:[{required:!0,validator:w,trigger:"blur"}]}),k=async()=>{try{await v.value.validate(async a=>{if(a){if(r.value=!0,e.bgList.length&&!e.bgList[0].id){const s=await J(e.bgList[0]);if(s.code==0){const{url:n}=s.result;e.site_avatar=n}}e.status=1;let t;e.id?t=await D(e):(e.user_id=_.value.id,t=await G(e)),t&&t.code==0?(p({offset:60,title:"提示",message:u("div",{style:"color: #7ec050; font-weight: 600;"},`${e.id?"修改":"申请"}成功，等待博主审核通过`)}),Object.assign(e,h),y.go(-1)):p({offset:60,title:"错误提示",message:u("div",{style:"color: #f56c6c; font-weight: 600;"},t.message)})}})}catch(a){console.error(a),p({offset:60,title:"错误提示",message:u("div",{style:"color: #f56c6c; font-weight: 600;"},"未知错误")})}finally{r.value=!1}};return I(()=>{if(_.value.id||(p({offset:60,title:"温馨提示",message:u("div",{style:"color: #e6c081; font-weight: 600;"},"请先登录")}),y.go(-1)),g.path=="/link/apply")m.value="apply";else if(g.path=="/link/update"){m.value=="update";let a=R("blog-link-update");a&&(e.bgList=[{id:1,url:a.site_avatar,name:a.site_avatar.split("/").slice(-1)}]),Object.assign(e,a),console.log(e)}}),(a,t)=>{const s=T,n=z,d=S,V=C,L=q;return A(),B(N,null,[l(s),b("div",M,[l(V,{class:"apply-form",ref_key:"formRef",ref:v,model:e,rules:x,"label-width":"100px","label-suffix":":"},{default:i(()=>[l(d,{label:"网站名称",prop:"site_name"},{default:i(()=>[l(n,{modelValue:e.site_name,"onUpdate:modelValue":t[0]||(t[0]=o=>e.site_name=o),style:{width:"220px"},placeholder:"请输入网站名称",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"网站描述",prop:"site_desc"},{default:i(()=>[l(n,{type:"textarea",modelValue:e.site_desc,"onUpdate:modelValue":t[1]||(t[1]=o=>e.site_desc=o),style:{width:"220px"},maxlength:"125",resize:"none",autosize:{minRows:2,maxRows:3},"show-word-limit":"",placeholder:"请输入网站描述",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"网站地址",prop:"url"},{default:i(()=>[l(n,{modelValue:e.url,"onUpdate:modelValue":t[2]||(t[2]=o=>e.url=o),style:{width:"220px"},placeholder:"请输入网站地址",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"网站头像",prop:"site_avatar"},{default:i(()=>[l(K,{"file-list":e.bgList,"onUpdate:fileList":t[3]||(t[3]=o=>e.bgList=o),limit:1,width:100,height:100,preview:!1},null,8,["file-list"])]),_:1})]),_:1},8,["model","rules"]),b("div",P,[l(L,{disabled:r.value,loading:r.value,class:"apply-link",onClick:k},{default:i(()=>[H(O(r.value?"努力上传中...":m.value=="apply"?"申请友链":"修改友链"),1)]),_:1},8,["disabled","loading"])])])],64)}}},re=E($,[["__scopeId","data-v-050392cd"]]);export{re as default};
