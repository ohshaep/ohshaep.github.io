import{_ as ve,J as pe,al as fe,A as f,K as F,H as he,aA as B,b3 as me,ae as ge,c as d,a as s,b as o,e as i,l as c,b4 as be,F as H,f as O,b5 as ye,d as U,I as G,t as _,u as ke,n as we,b6 as xe,G as Ce,r as Ie,o as l,q as A,b7 as Le,h as P,b8 as Me,k as V,y as g,j as Te,aB as Ee,b9 as Se,ba as ze,bb as W,ay as Be,v as He,x as Ae,ap as x,S as C,aD as X,aF as J,aH as Ve,D as De,X as $e,E as Ne,p as je,s as qe,az as Re}from"./index-1220b33e.js";import{E as Fe}from"./el-skeleton-item-1854ac38.js";import{g as Oe,a as Ue,c as Ge,l as Pe,d as We}from"./message-3fa9354f.js";import{c as Xe,a as Je}from"./like-3359d30f.js";import{E as Ke}from"./index-8ef6b4c4.js";const D=b=>(He("data-v-8d7a637b"),b=b(),Ae(),b),Qe={class:"publish-pc"},Ye={class:"publish-mobile"},Ze={class:"message-header"},et=D(()=>s("div",{class:"message-title"},"留言板",-1)),tt={class:"flex items-center !h-[5rem]"},st={class:"message-body center_box"},at={class:"tab"},ot=["onClick"],lt={key:0,class:"!py-[5px] flex justify-center items-center"},nt=D(()=>s("div",{class:"loading"},[s("div",{class:"coffee_cup"})],-1)),it={key:0,class:"img-loading"},ct={class:"top-header"},rt={class:"flex items-center"},dt={class:"nick-name"},_t={key:0,class:"flex items-center cursor-pointer option-top"},ut=["innerHTML"],vt={class:"bottom"},pt={class:"left flex items-center"},ft={class:"time"},ht=["onClick"],mt=D(()=>s("span",null,"评论",-1)),gt={class:"!ml-[5px]"},bt={class:"index-tag"},yt={class:"flex justify-start items-center option"},kt=["onClick"],wt={class:"observer"},xt={__name:"index",setup(b){const I=ke(),K=pe(),{getUserInfo:u}=fe(K),r=f([]),L=f(0),y=f(!1),M=f(!1);let v,m;const n=F({current:1,size:8,tag:"",message:"",user_id:u.value.id}),Q=F({...n}),$=f(0),k=f([]),T=f(!1),E=f(""),Y=(t,a)=>{$.value=t,n.tag=a,E.value="",a=="全部"&&(n.tag=""),n.current=1,h()},Z=()=>{m=document.querySelector(".observer"),v=new IntersectionObserver(t=>{t.forEach(async a=>{a.isIntersecting&&a.intersectionRatio>0&&L.value>r.value.length&&!y.value&&(n.current++,h())})},{rootMargin:"0px 0px 300px 0px"}),m&&v.observe(m)},h=async()=>{n.current==1?y.value=!0:M.value=!0;try{let t=await Oe(n);if(t.code==0){const{list:a}=t.result;r.value=n.current==1?t.result.list:r.value.concat(t.result.list);let p=t.result.list.map((q,S)=>".message"+(r.value.length-a.length+S));L.value=t.result.total,we(()=>{xe(p,0,1.2)})}}finally{y.value=!1,M.value=!1}},ee=async(t,a)=>{t.is_like?(await Ge(t.id)).code==0&&(u.value.id&&await Xe({for_id:t.id,type:3,user_id:u.value.id}),r.value[a].like_times--,r.value[a].is_like=!1,x({offset:60,title:"提示",message:C("div",{style:"color: #7ec050; font-weight: 600;"},"已取消点赞")})):(await Pe(t.id)).code==0&&(u.value.id&&await Je({for_id:t.id,type:3,user_id:u.value.id}),r.value[a].like_times++,r.value[a].is_like=!0,x({offset:60,title:"提示",message:C("div",{style:"color: #7ec050; font-weight: 600;"},"点赞成功")}))},te=t=>{t&&X("blog-message-item",t),I.push({path:"/message/detail"})},se=t=>{t&&X("blog-message-item",t),I.push({path:"/message/publish",query:{type:"edit"}})},N=()=>{I.push({path:"/message/publish",query:{type:"add"}})},ae=t=>{Ke.confirm("确认删除留言吗","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(async()=>{const a=await We(t.id);a&&a.code==0?(x({offset:60,title:"提示",message:C("div",{style:"color: #7ec050; font-weight: 600;"},"删除成功")}),v&&v.unobserve(m),v=null,n.current=1,h()):x({offset:60,title:"错误提示",message:C("div",{style:"color: #f56c6c; font-weight: 600;"},a.message)})})},j=async()=>{k.value=[];const t=await Ue();t.code==0&&(k.value=Array.isArray(t.result)?t.result.map((a,p)=>({key:p+1,label:a.tag})):[],k.value.unshift({key:0,label:"全部"}))},oe=()=>{T.value=!0},le=()=>{T.value=!1},ne=t=>{n.message=t,h()};return he(async()=>{B("message-refresh"),await j(),await h(),Z()}),me(async()=>{J("message-refresh")&&(Object.assign(n,Q),await j(),await h(),B("message-refresh")),J("message-need-scroll")&&(window.scrollTo({top:0,behavior:"smooth"}),B("message-need-scroll"))}),ge(()=>{v&&v.unobserve(m),v=null}),(t,a)=>{const p=Ce,q=Ve,S=De,R=$e,ie=Ne,ce=je,re=qe,de=Fe,_e=Re,ue=Ie("image");return l(),d("div",{class:"message !min-h-[60vh]",onClick:le},[s("div",Qe,[o(p,{placement:"top-start",width:110,trigger:"hover",content:"点我去发表留言"},{reference:i(()=>[o(A,{name:"publish",width:4,height:4,onClick:N})]),_:1})]),s("div",Ye,[o(p,{placement:"top-start",width:110,trigger:"hover",content:"点我去发表留言"},{reference:i(()=>[o(A,{name:"publish",width:3,height:3,onClick:N})]),_:1})]),s("div",Ze,[et,s("div",tt,[o(c(Le),{size:"1.2rem",typeList:["生活原本沉闷，但跑起来就会有风!"]})])]),s("div",st,[s("div",{class:"search-tab",onClick:be(oe,["stop"])},[s("ul",at,[(l(!0),d(H,null,O(k.value,e=>(l(),d("li",{key:e.key,onClick:w=>Y(e.key,e.label)},[s("div",{class:P([e.key==$.value?"active-tab":"","tab-li"])},_(e.label),3)],8,ot))),128))]),o(ye,{duration:{enter:0,leave:500},"enter-active-class":"animate__animated animate__fadeIn","leave-active-class":"animate__animated animate__fadeOut"},{default:i(()=>[T.value?(l(),d("div",lt,[o(q,{"prefix-icon":c(Me),class:"search",modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),placeholder:"搜索留言内容",onChange:ne,clearable:""},null,8,["prefix-icon","modelValue"])])):V("",!0)]),_:1})]),o(de,{loading:y.value,style:{height:"100%"},animated:""},{template:i(()=>[nt]),default:i(()=>[o(re,{class:"row-height",gutter:16},{default:i(()=>[(l(!0),d(H,null,O(r.value,(e,w)=>(l(),U(ce,{class:P("message"+w),xs:24,sm:12,key:w},{default:i(()=>[o(ie,{class:"card-hover"},{default:i(()=>[s("div",{style:g({backgroundColor:e.bg_color}),class:"message-card animate__animated animate__fadeIn"},[e.bg_url?Te((l(),d("div",it,null,512)),[[ue,e.bg_url]]):V("",!0),s("div",{class:"top",style:g({backgroundImage:e.bg_url?`url(${e.bg_url})`:""})},[s("div",ct,[s("div",rt,[o(S,{class:"left-avatar",src:e.avatar},{default:i(()=>[G(_(e.nick_name),1)]),_:2},1032,["src"]),s("span",dt,_(e.nick_name),1)]),c(u).id&&c(u).id==e.user_id||c(u).role==1?(l(),d("div",_t,[o(R,{onClick:z=>se(e)},{default:i(()=>[o(c(Ee))]),_:2},1032,["onClick"]),o(R,{class:"!ml-[10px]",onClick:z=>ae(e)},{default:i(()=>[o(c(Se))]),_:2},1032,["onClick"])])):V("",!0)]),c(ze)(c(W)(e.message))?(l(),d("div",{key:0,innerHTML:c(W)(e.message),style:g({color:e.color,fontSize:e.font_size+"px",fontWeight:e.font_weight})},null,12,ut)):(l(),d("div",{key:1,style:g({color:e.color,fontSize:e.font_size+"px",fontWeight:e.font_weight})},_(e.message),5))],4),s("div",vt,[s("div",pt,[s("div",ft,_(c(Be)(e.createdAt))+"前",1),s("div",{class:"message-comment cursor-pointer !mr-[10px]",onClick:z=>te(e)},[mt,s("span",gt,_(e.comment_total),1)],8,ht),s("div",bt,"#"+_(e.tag),1)]),s("div",yt,[s("div",{class:"cursor-pointer scale flex items-center",onClick:z=>ee(e,w)},[o(A,{name:e.is_like?"redHeart":"greyHeart",width:1.5},null,8,["name"]),s("span",{style:g({color:e.is_like?"#f00":""}),class:"!ml-[5px]"},_(e.like_times||0),5)],8,kt)])])],4)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1},8,["loading"]),s("div",wt,[M.value?(l(),U(_e,{key:0,size:32})):(l(),d(H,{key:1},[G(_(r.value.length>=L.value?"已经到底了~":"下拉加载更多～"),1)],64))])])])}}},Et=ve(xt,[["__scopeId","data-v-8d7a637b"]]);export{Et as default};
