import{a1 as I,_ as M,J as O,A as v,K as J,H as K,ae as Q,c as n,b as s,a as e,e as p,F as h,E as W,r as X,o,f as k,ax as Y,k as R,t as g,j as B,l as Z,ay as ee,h as N,d as te,I as se,ap as S,S as D,D as ie,q as ae,az as oe}from"./index-9c00c9ce.js";import{E as ne}from"./el-skeleton-item-b39314d0.js";import{E as le}from"./el-image-viewer-623ed655.js";import{_ as re}from"./index-e6d92354.js";import{c as ce,a as _e}from"./like-de195296.js";import{T as de,_ as pe}from"./Comment-10927a74.js";import{_ as l}from"./skeleton-item-956a27b0.js";import"./el-dropdown-0230fa9d.js";import"./el-scrollbar-9357c77b.js";import"./castArray-7df2df44.js";import"./index-3cf87c02.js";import"./pagination-5806909c.js";import"./el-select-ce01c66f.js";import"./strings-d9fd212b.js";import"./hasIn-cbe45c80.js";import"./index-0a78f20c.js";const me=m=>new Promise((c,a)=>{I.post("/api/talk/blogGetTalkList",m).then(r=>{c(r)})}),he=m=>new Promise((c,a)=>{I.put("/api/talk/like/"+m,{}).then(r=>{c(r)})}),ue=m=>new Promise((c,a)=>{I.put("/api/talk/cancelLike/"+m,{}).then(r=>{c(r)})});const ve={class:"talk center_box"},ge={class:"w-[70%] !ml-[10px]"},fe={class:"flex justify-between !w-[40%]"},xe={class:"flex w-[20%]"},we={class:"w-[100%] !ml-[10px]"},ke={class:"flex justify-between !w-[80%]"},ye={class:"flex w-[20%]"},Le={class:"talk-card__item animate__animated animate__fadeIn"},be={class:"left"},Ie={class:"w-[100%]"},Ce={class:"right"},Ee={class:"right-top relative"},je={key:0,class:"iconfont icon-zhiding"},Te={class:"nick-name"},ze=["onClick"],Ae={key:0,class:"right-bottom"},Re={class:"w-[100%] h-[100%] grid place-items-center"},Be={key:1,class:"right-bottom-one"},Ne={class:"flex justify-center items-center w-[100%] h-[100%] overflow-hidden"},Se={class:"w-[100%] h-[100%] grid place-items-center"},De={class:"like flex justify-between items-center !mt-[15px]"},Pe={class:"time"},Ue=["onClick"],Ve=["onClick"],qe={class:"!mt-[10px]"},Ge={class:"observer"},$e={__name:"talk",setup(m){const c=O(),a=v([]),r=v(0),f=v(!1),y=v(!1),C=v(null);let u,L;const x=J({current:1,size:5,user_id:c.getUserInfo.id}),P=()=>{L=document.querySelector(".observer"),u=new IntersectionObserver(i=>{i.forEach(async _=>{_.isIntersecting&&_.intersectionRatio>0&&r.value>a.value.length&&(x.current++,E())})},{rootMargin:"0px 0px 300px 0px"}),u.observe(L)},E=async()=>{try{x.current==1?f.value=!0:y.value=!0;let i=await me(x);i.code==0&&(a.value=x.current==1?i.result.list:a.value.concat(i.result.list),r.value=i.result.total)}finally{f.value=!1,y.value=!1}},U=async(i,_)=>{i.is_like?(await ue(i.id)).code==0&&(await ce({for_id:i.id,type:2,user_id:c.getUserInfo.id}),a.value[_].is_like=!1,a.value[_].like_times--,S({offset:60,title:"提示",message:D("div",{style:"color: #7ec050; font-weight: 600;"},"已取消点赞")})):(await he(i.id)).code==0&&(await _e({for_id:i.id,type:2,user_id:c.getUserInfo.id}),a.value[_].is_like=!0,a.value[_].like_times++,S({offset:60,title:"提示",message:D("div",{style:"color: #7ec050; font-weight: 600;"},"点赞成功")}))},V=i=>{C.value[i].toggleExpand()};return K(async()=>{await E(),a.value.length<r.value&&P()}),Q(()=>{u&&u.unobserve(L),u=null}),(i,_)=>{const b=re,q=ie,j=ae,T=le,G=oe,$=ne,F=W,z=X("image");return o(),n(h,null,[s(b,{loading:f.value},null,8,["loading"]),e("div",ve,[s(F,{class:"talk-card"},{default:p(()=>[s($,{loading:f.value,style:{height:"100%"},animated:""},{template:p(()=>[(o(),n(h,null,k(3,t=>e("div",{class:"pc-skeleton flex justify-start w-[100%] !mt-[30px]",key:t},[s(l,{variant:"text",width:"80px",height:"80px"}),e("div",ge,[s(l,{variant:"text",width:"40%",height:"20px"}),s(l,{variant:"image",width:"40%",height:"180px",top:"10px"}),e("div",fe,[s(l,{variant:"text",width:"10%",height:"20px",top:"10px"}),e("div",xe,[s(l,{variant:"text",width:"50%",height:"20px",top:"10px"}),s(l,{variant:"text",width:"50%",height:"20px",top:"10px",left:"10px"})])])])])),64)),(o(),n(h,null,k(3,t=>e("div",{class:"mobile-skeleton flex justify-start w-[100%] !mt-[30px]",key:t},[s(l,{variant:"text",width:"80px",height:"80px"}),e("div",we,[s(l,{variant:"text",width:"80%",height:"20px"}),s(l,{variant:"image",width:"80%",height:"180px",top:"10px"}),e("div",ke,[s(l,{variant:"text",width:"10%",height:"20px",top:"10px"}),e("div",ye,[s(l,{variant:"text",width:"50%",height:"20px",top:"10px"}),s(l,{variant:"text",width:"50%",height:"20px",top:"10px",left:"10px"})])])])])),64))]),default:p(()=>[s(Y,{name:"scroll-list",tag:"div"},{default:p(()=>[(o(!0),n(h,null,k(a.value,(t,A)=>(o(),n("div",{class:"w-[100%] talk-item-line",key:t.id},[e("div",Le,[e("div",be,[s(q,{class:"left-avatar",src:t.avatar,shape:"square"},null,8,["src"])]),e("div",Ie,[e("div",Ce,[e("div",Ee,[t.is_top==1?(o(),n("i",je)):R("",!0),e("span",Te,g(t.nick_name),1),s(de,{class:"content",text:t.content,maxLines:3,"font-size":14},{default:p(({clickToggle:d,expanded:w})=>[e("span",{onClick:d,class:"btn"},g(w?"收起":"展开"),9,ze)]),_:2},1032,["text"])]),Array.isArray(t.talkImgList)&&t.talkImgList.length>1?(o(),n("div",Ae,[(o(!0),n(h,null,k(t.talkImgList,(d,w)=>B((o(),n("div",{class:"image",key:w},[s(T,{class:"w-[100%] h-[100%]",src:d,loading:"lazy","preview-teleported":"","initial-index":w,fit:"cover","preview-src-list":t.talkImgList.map(H=>H)},{error:p(()=>[e("div",Re,[s(j,{name:"image404",width:5,height:5})])]),_:2},1032,["src","initial-index","preview-src-list"])])),[[z,d]])),128))])):Array.isArray(t.talkImgList)&&t.talkImgList.length==1?(o(),n("div",Be,[B((o(),n("div",Ne,[s(T,{class:"w-[100%] h-[100%]",src:t.talkImgList[0],loading:"lazy","preview-teleported":"","initial-index":0,fit:"cover","preview-src-list":t.talkImgList.map(d=>d)},{error:p(()=>[e("div",Se,[s(j,{name:"image404",width:8,height:8})])]),_:2},1032,["src","preview-src-list"])])),[[z,t.talkImgList[0]]])])):R("",!0),e("div",De,[e("div",Pe,g(Z(ee)(t.createdAt))+"前",1),e("div",null,[e("i",{class:"comment-icon iconfont icon-speechbubble",onClick:d=>V(A)},null,8,Ue),e("i",{class:N(["iconfont","icon-icon1","!ml-[10px]",t.is_like?"is-like":""]),onClick:d=>U(t,A)},null,10,Ve),e("span",{class:N([t.is_like?"is-like":"","!ml-[5px]"])},g(t.like_times),3)])]),e("div",qe,[s(pe,{ref_for:!0,ref_key:"talkCommentRef",ref:C,class:"w-[100%]",type:"talk",id:t.id,"author-id":t.user_id,"is-show-toggle":!1},null,8,["id","author-id"])])])])])]))),128))]),_:1}),e("div",Ge,[y.value?(o(),te(G,{key:0,size:32})):(o(),n(h,{key:1},[se(g(a.value.length>=r.value?"已经到底了~":"下拉加载更多～"),1)],64))])]),_:1},8,["loading"])]),_:1})])],64)}}},ot=M($e,[["__scopeId","data-v-855045ca"]]);export{ot as default};
