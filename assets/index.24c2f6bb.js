import{aI as D,z as ot,r,A as q,ca as lt,at as H,V as st,C as ut,o as d,c as k,d as s,w as l,e as f,t as I,f as i,g as _,F as K,W as J,h as rt,cb as dt,D as it,b6 as ct,i as h,Q as T,cc as pt,m as A,_ as ft,a3 as mt,n as _t,l as vt,B as yt,s as ht,q as gt,a6 as bt,bW as kt,b3 as It,a9 as St,bX as wt,bY as Ct,bZ as xt,b_ as Nt,x as Rt,p as Ut,cd as Dt,M as jt,b$ as Tt,a4 as Pt,N as Qt,O as Lt,G as $t}from"./index.192c8708.js";import{d as Mt}from"./newPurchase.bb088d76.js";import{u as Et}from"./common.e897a13c.js";const de=[{title:"\u5E8F\u53F7",dataIndex:"key",key:"key",align:"center",width:50,scopedSlots:{customRender:(m,B,V)=>`${V+1}`}},{title:"\u5546\u54C1\u7F16\u7801",dataIndex:"productCode",width:150,ellipsis:!0,key:"productCode",scopedSlots:{customRender:"productCode"},slots:{customRender:"productCode"}},{title:"\u5546\u54C1\u540D\u79F0",dataIndex:"productName",width:180,ellipsis:!0,key:"productName",scopedSlots:{customRender:"productName"},slots:{customRender:"productName"}},{title:"\u89C4\u683C\u578B\u53F7",dataIndex:"productSpec",width:150,ellipsis:!0,scopedSlots:{customRender:"productSpec"},slots:{customRender:"productSpec"}},{title:"\u6570\u91CF",dataIndex:"orderQuality",width:150,ellipsis:!0,scopedSlots:{customRender:"orderQuality"},slots:{customRender:"orderQuality"},summary:!0,type:"orderQuality"},{title:"\u8BA1\u91CF\u5355\u4F4D",dataIndex:"measureUnit",width:150,ellipsis:!0,scopedSlots:{customRender:"measureUnit"},slots:{customRender:"measureUnit"}},{title:"\u57FA\u672C\u8BA1\u91CF\u5355\u4F4D\u6570\u91CF",dataIndex:"jbjsdwsl",width:150,ellipsis:!0,scopedSlots:{customRender:"jbjsdwsl"},slots:{customRender:"jbjsdwsl"},summary:!0,type:"jbjsdwsl"},{title:"\u57FA\u672C\u8BA1\u91CF\u5355\u4F4D",dataIndex:"baseMeasureUnit",width:150,ellipsis:!0,scopedSlots:{customRender:"baseMeasureUnit"},slots:{customRender:"baseMeasureUnit"}},{title:"\u542B\u7A0E\u5355\u4EF7(\u5143)",dataIndex:"unitPrice",width:150,ellipsis:!0,scopedSlots:{customRender:"unitPrice"},slots:{customRender:"unitPrice"}},{title:"\u542B\u7A0E\u5408\u8BA1(\u5143)",dataIndex:"hshj",width:150,ellipsis:!0,scopedSlots:{customRender:"hshj"},slots:{customRender:"hshj"},summary:!0,type:"hshj"},{title:"\u53D1\u8D27\u4ED3\u5E93",dataIndex:"sendStorehouse",width:150,ellipsis:!0,scopedSlots:{customRender:"sendStorehouse"},slots:{customRender:"sendStorehouse"}},{title:"\u8BA2\u5355\u65F6\u95F4",dataIndex:"orderDate",width:150,ellipsis:!0,scopedSlots:{customRender:"orderDate"},slots:{customRender:"orderDate"}},{title:"\u53D1\u8D27\u65E5\u671F",dataIndex:"sendDate",width:300,ellipsis:!0,scopedSlots:{customRender:"sendDate"},slots:{customRender:"sendDate"}},{title:"\u5907\u6CE8",dataIndex:"remark",width:150,ellipsis:!0,scopedSlots:{customRender:"remark"},slots:{customRender:"remark"}}];function Ft(m){return D({url:"/saleOrderInfo/add",method:"post",data:m})}function Ot(m){return D({url:"/cooperatorInfo/selectList",method:"post",params:m})}function qt(m){return D({url:"/storehouseInfo/selectList",method:"post",params:m})}function Kt(){return D({url:"/categoryManage/tree",method:"get"})}function At(m){return D({url:"/productInfo/selectList",method:"post",params:m})}function Bt(){return D({url:"/saleOrderInfo/getDraft",method:"get"})}const P=m=>(Qt("data-v-0421b232"),m=m(),Lt(),m),Vt=P(()=>i("span",{class:"separate"},"/",-1)),Yt=P(()=>i("span",null,"\u5BA1\u6279\u5217\u8868",-1)),zt={class:"app-container"},Gt={class:"container-wrapper"},Wt={style:{display:"flex","align-items":"center"}},Xt=["onClick"],Zt={key:5},Ht={key:6},Jt={class:"ant-upload-drag-icon"},ea=P(()=>i("p",{class:"ant-upload-text"},[i("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),ta={class:"dialog-footer"},aa=P(()=>i("div",null,[i("span",null,"\u5546\u54C1\u5206\u7C7B")],-1)),na={class:"head-container"},oa={key:1,style:{"text-align":"center"}},la=P(()=>i("span",null,"\u6682\u65E0\u6570\u636E",-1)),sa=[la],ua={__name:"index",setup(m){const{proxy:B}=$t(),V=r("\u5546\u54C1\u4FE1\u606F"),Q=r(!1),g=r([]),S=r([]),U=r([]),L=r([]),ie=e=>{p.value.cooperatorId=void 0,e?L.value=O.value.filter(t=>t.label.indexOf(e)>-1):L.value=O.value};function ce(){w.open=!0,g.value=[]}const w=q({open:!1,title:"",isUploading:!1,updateSupport:!1,headers:{Authorization:lt(),"Content-Type":"multipart/form-data"}});async function pe(){if(U.value=[],S.value=[],g.value.length<1){w.open=!1;return}let e=g.value[0].originFileObj;if(!e)return;if(!(e.size/1024/1024<50)){const c=g.indexOf(e);return g.splice(c,1),ElMessage.warning("\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 50MB!!"),!1}var a=new FormData;a.append("file",e);const u=await Et(a,w.updateSupport);U.value.push(u.data),S.value.push(g.value[0].originFileObj.name),A.success("\u4E0A\u4F20\u6210\u529F"),w.open=!1}function fe(e){S.value.splice(e,1),U.value[e]&&(U.value.splice(e,1),g.value.splice(e,1))}const me=r([{value:1,label:"\u5B9A\u5411\u8D2D\u9500"},{value:2,label:"\u81EA\u4E3B\u7ECF\u8425"}]),b=r(void 0),_e=r([{title:"\u7269\u6599\u7F16\u7801",dataIndex:"id",ellipsis:!0,scopedSlots:{customRender:"id"},slots:{customRender:"id"}},{title:"\u7269\u6599\u540D\u79F0",dataIndex:"productName",ellipsis:!0,scopedSlots:{customRender:"productName"},slots:{customRender:"productName"}},{title:"\u89C4\u683C\u578B\u53F7",dataIndex:"specName",ellipsis:!0,scopedSlots:{customRender:"specName"},slots:{customRender:"specName"}},{title:"\u57FA\u672C\u8BA1\u91CF\u5355\u4F4D",dataIndex:"measurementUnit",ellipsis:!0}]),$=r([]),ee=r([]),ve=r(!0);function ye(e,t){if(b.value=void 0,e.length!=0){let a;t.node.ctgLevel==1?a={ctgLevel1Id:e[0]}:a={ctgLevel2Id:e[0]},At(a).then(u=>{let c=u==null?void 0:u.data;b.value=c})}}const he=e=>{ee.value=e,ve.value=!1},ge=["productCode","productName","productSpec","orderQuality","measureUnit","jbjsdwsl","baseMeasureUnit","unitPrice","hshj","nature","cooperatorId","orderDate","sendStorehouse","sendDate","remark"],be=["sendDate"],ke=[""],Ie=["orderQuality","unitPrice","remark"],Se=["measureUnit","nature","cooperatorId","sendStorehouse"],M=r([]),o=r([{key:1,orderQuality:void 0,unitPrice:void 0,remark:void 0,productName:void 0,measureUnit:3,sendStorehouse:void 0,cooperatorId:void 0,sendDate:void 0,editable:!0}]);r(!0);const te=r(),we=q({queryParams:{orderType:void 0,cooperatorId:void 0,contractNo:void 0,currency:void 0},rules:{orderType:[{required:!0,message:"\u5FC5\u9009",trigger:["change"]}],cooperatorId:[{required:!0,message:"\u5FC5\u9009",trigger:["change"]}],contractNo:[{required:!0,message:"\u5FC5\u586B",trigger:"blur"}]}}),Ce=async(e,t)=>(await Mt(e)).data;function E(e,t){if(o.value[e].orderQuality&&o.value[e].measureUnit&&o.value[e].unitPrice&&o.value[e].baseMeasureUnit){let a={orderQuality:o.value[e].orderQuality,measureUnit:o.value[e].measureUnit,baseMeasureUnit:o.value[e].baseMeasureUnit,unitPrice:o.value[e].unitPrice};Ce(a).then(c=>{o.value[e].jbjsdwsl=c.baseQuality,o.value[e].hshj=c.totalPrice})}}function xe(){S.value=[],B.resetForm("queryRef"),o.value=[{key:1,orderQuality:void 0,unitPrice:void 0,remark:void 0,productName:void 0,measureUnit:void 0,cooperatorId:void 0,sendStorehouse:void 0,sendDate:void 0,editable:!0}]}async function ae(e){e!=1&&await te.value.validateFields(),o.value.forEach((t,a)=>{var u,c;t.orderType=p.value.orderType,t.contractNo=p.value.contractNo,t.cooperatorId=p.value.cooperatorId,t.fileNames=(u=S.value)==null?void 0:u.toString(),t.fileInfo=(c=U.value)==null?void 0:c.toString(),t.isDraft=e}),Ft(o.value).then(t=>{t.code==200&&(e==0&&(S.value=[],B.resetForm("queryRef"),o.value=[{key:1,orderQuality:void 0,unitPrice:void 0,remark:void 0,productName:void 0,measureUnit:void 0,cooperatorId:void 0,sendStorehouse:void 0,sendDate:void 0,editable:!0}]),A.success("\u4FDD\u5B58\u6210\u529F"))})}const Y=r(0),Ne=H(()=>(Y.value=0,o.value.forEach((e,t)=>{e.hshj&&(Y.value+=Number(e.hshj))}),Y.value)),z=r(0),Re=H(()=>(z.value=0,o.value.forEach((e,t)=>{e.orderQuality&&(z.value+=Number(e.orderQuality))}),z.value)),G=r(0),Ue=H(()=>(G.value=0,o.value.forEach((e,t)=>{e.jbjsdwsl&&(G.value+=Number(e.jbjsdwsl))}),G.value)),C=r(void 0);function De(e){C.value=e,Ae(),Q.value=!0}function je(e){if(e=="measureUnit")return[{value:1,label:"\u65A4"},{value:2,label:"\u516C\u65A4/\u5343\u514B"},{value:3,label:"\u5428"}];if(e=="sendStorehouse")return ne.value}function Te(e,t,a){console.log(t,"col",e,"value",a,"index"),t=="unitPrice"?(e!==""&&e.substr(0,1)==="."&&(e=""),e=e.replace(/^0*(0\.|[1-9])/,"$1"),e=e.replace(/[^\d.]/g,""),e=e.replace(/\.{2,}/g,"."),e=e.replace(".","$#$").replace(/\./g,"").replace("$#$","."),e=e.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),e.indexOf(".")<0&&e!==""&&e.substr(0,1)==="0"&&e.length===2&&(e=e.substr(1,e.length)),o.value[a][t]=e):(t=="orderQuality"&&(e=e.replace(/^0*(0\.|[1-9])/,"$1"),e=e.replace(/[^\d.]/g,""),e=e.replace(/(\d*\.\d{0,3}).*/,"$1")),o.value[a][t]=e),e==""&&(o.value[a].jbjsdwsl=null,o.value[a].hshj=null),(t=="orderQuality"||t=="unitPrice")&&E(a)}function Pe(e,t,a){console.log(e,t,a),o.value[a].sendDate=e[0],o.value[a].sendDateEnd=e[1]}function Qe(e,t,a){o.value[a][t]=e,t=="measureUnit"&&E(a)}const Le=q({onChange:(e,t)=>{M.value=[],M.value=t.map(a=>a.key)}}),F=r(""),$e=q({type:"radio",onChange:(e,t)=>{F.value=e}}),Me=()=>{if(F.value!==""&&F.value!==null){let e=F.value;o.value[C.value].productName=b.value[e].productName,o.value[C.value].productCode=b.value[e].productId,o.value[C.value].productId=b.value[e].productId,o.value[C.value].productSpec=b.value[e].specName,o.value[C.value].productSpecId=b.value[e].id,o.value[C.value].baseMeasureUnit=b.value[e].measurementUnit,E(C.value),Q.value=!1}else A.error("\u8BF7\u9009\u62E9\u89C4\u683C")};function Ee(){let e={key:o.value.length+1,orderQuality:void 0,unitPrice:void 0,remark:void 0,productName:void 0,measureUnit:void 0,cooperatorId:void 0,sendStorehouse:void 0,orderDate:void 0,sendDate:void 0,sendDateEnd:void 0,editable:!0};o.value.push(e)}function Fe(){M.value.length!=0?M.value.forEach((e,t)=>{o.value.forEach((a,u)=>{e==a.key&&o.value.splice(u,1)})}):A.error("\u8BF7\u52FE\u9009\u4E00\u9879")}const Oe=e=>{if(e.length<1)return[];function t(a){a.map(u=>{u.key=u.id,u.title=u.ctgName,u.children&&u.children.length&&t(u.children)})}return t(e),e},O=r([]);function qe(){Ot().then(e=>{(e==null?void 0:e.data).forEach(a=>{O.value.push({value:a.id,label:a.cooperatorName})})}).finally(e=>{L.value=O.value})}const ne=r([]);function Ke(){qt().then(e=>{(e==null?void 0:e.data).forEach(a=>{ne.value.push({value:a.id,label:a.storeName})})})}function Ae(){Kt().then(e=>{const t=(e==null?void 0:e.data)||[],a=Oe(t);$.value=a,oe(t)})}const Be=[],oe=e=>{if(!!e)for(let t=0;t<e.length;t++){const a=e[t],u=a.key;Be.push({key:u,title:a.title}),a.children&&oe(a.children)}},Ve=()=>{Bt().then(e=>{e.data.length!=0&&(o.value=e.data,p.value.orderType=e.data[0].orderType,p.value.contractNo=e.data[0].contractNo,p.value.cooperatorId=e.data[0].cooperatorId,U.value.push(e.data[0].fileInfo),S.value.push(e.data[0].fileNames),e.data.forEach((t,a)=>{E(a),o.value[a].key=a+1,o.value[a].editable=!0}))})},{queryParams:p,rules:Ye}=st(we);return qe(),Ke(),Ve(),(e,t)=>{const a=ft,u=mt,c=_t,ze=vt,Ge=ut("upload-outlined"),x=yt,We=ht,W=gt,le=bt,Xe=kt,Ze=It,He=St,se=wt,X=Ct,Je=xt,et=Nt,ue=Rt,j=Ut,tt=Dt,re=jt,at=Tt,nt=Pt;return d(),k(K,null,[s(a,{title:"\u65B0\u589E\u9500\u552E\u8BA2\u5355",icon:"icon-rongqi"},{nav:l(()=>[f(I("\u9500\u552E\u7BA1\u7406")+" "),Vt,Yt]),_:1}),i("div",zt,[s(W,{justify:"space-between",style:{flex:"1"}},{default:l(()=>[i("div",Gt,[s(We,{layout:"inline",ref_key:"queryRef",ref:te,rules:_(Ye),model:_(p)},{default:l(()=>[s(c,{label:"",name:"orderType"},{default:l(()=>[s(u,{label:"\u8BA2\u5355\u7C7B\u578B",placeholder:"\u8BF7\u9009\u62E9",style:{width:"240px"},clearable:"",value:_(p).orderType,"onUpdate:value":t[0]||(t[0]=n=>_(p).orderType=n),options:me.value},null,8,["value","options"])]),_:1}),s(c,{label:"",name:"cooperatorId"},{default:l(()=>[s(u,{label:"\xA0\u5BA2\u6237\xA0",placeholder:"\u8BF7\u9009\u62E9",style:{width:"240px"},"show-search":"",clearable:"",value:_(p).cooperatorId,"onUpdate:value":t[1]||(t[1]=n=>_(p).cooperatorId=n),options:L.value,"filter-option":!1,onSearch:ie},null,8,["value","options"])]),_:1}),s(c,{name:"contractNo"},{default:l(()=>[s(ze,{label:"\u9500\u552E\u5408\u540C\u53F7",placeholder:"\u8BF7\u8F93\u5165",value:_(p).contractNo,"onUpdate:value":t[2]||(t[2]=n=>_(p).contractNo=n),style:{width:"240px"},onkeyup:"this.value=this.value.replace(/[^u4e00-u9fa5w\\/-]/g,'')"},null,8,["value"])]),_:1}),s(c,{name:"fileInfo"},{default:l(()=>[s(x,{onClick:ce},{default:l(()=>[s(Ge),f(" \u4E0A\u4F20\u5408\u540C ")]),_:1}),(d(!0),k(K,null,J(S.value,(n,v)=>(d(),k("div",Wt,[i("div",null,[i("span",null,I(n),1)]),i("div",{style:{"margin-left":"10px"},onClick:R=>fe(v)},[rt(s(_(dt),null,null,512),[[it,n]])],8,Xt)]))),256))]),_:1}),s(c,null,{default:l(()=>[s(x,{type:"primary",onClick:Ee},{default:l(()=>[f("\u65B0\u589E")]),_:1}),s(x,{type:"primary",onClick:Fe,style:{"margin-left":"15px"}},{default:l(()=>[f("\u5220\u9664")]),_:1})]),_:1})]),_:1},8,["rules","model"])])]),_:1}),s(ue,{scroll:{x:"max-content",y:240},columns:_(de),"data-source":o.value,bordered:"",size:"small","row-Selection":Le,rowKey:(n,v)=>v,summary:!0},ct({summary:l(()=>[s(et,{fixed:""},{default:l(()=>[s(Je,null,{default:l(()=>[s(se,{index:0},{default:l(()=>[f(" \u5408\u8BA1")]),_:1}),(d(!0),k(K,null,J(_(de),(n,v)=>(d(),h(se,{key:v,index:1},{default:l(()=>[n!=null&&n.summary?(d(),k(K,{key:0},[n.type=="orderQuality"?(d(),h(X,{key:0},{default:l(()=>[f(I(Re.value),1)]),_:1})):T("",!0),n.type=="jbjsdwsl"?(d(),h(X,{key:1},{default:l(()=>[f(I(Ue.value),1)]),_:1})):T("",!0),n.type=="hshj"?(d(),h(X,{key:2},{default:l(()=>[f(I(Ne.value),1)]),_:1})):T("",!0)],64)):T("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:2},[J(ge,n=>({name:n,fn:l(({column:v,record:R,index:y,text:Z,value:ra})=>[(d(),k("div",{key:n},[R.editable&&Ie.includes(n)?(d(),h(le,{key:0,"read-only":ke.includes(n),placeholder:"\u8BF7\u8F93\u5165",value:Z,onChange:N=>Te(N.target.value,n,y)},null,8,["read-only","value","onChange"])):R.editable&&["orderDate"].includes(n)?(d(),h(Xe,{key:1,placeholder:"\u8BF7\u9009\u62E9\u65F6\u95F4",value:o.value[y][n],"onUpdate:value":N=>o.value[y][n]=N},null,8,["value","onUpdate:value"])):R.editable&&be.includes(n)?(d(),h(Ze,{key:2,valueFormat:"YYYY-MM-DD",onChange:N=>Pe(N,n,y)},null,8,["onChange"])):R.editable&&Se.includes(n)?(d(),h(He,{key:3,placeholder:"\u8BF7\u9009\u62E9",style:{display:"block"},value:Z,options:je(n),onChange:N=>Qe(N,n,y)},null,8,["value","options","onChange"])):R.editable&&n=="productName"?(d(),h(le,{key:4,"read-only":"true",placeholder:"\u8BF7\u70B9\u51FB\u9009\u62E9",value:Z,onClick:N=>De(y)},null,8,["value","onClick"])):R.editable&&n=="baseMeasureUnit"?(d(),k("span",Zt,I(o.value[y][n]==null?"\u81EA\u52A8\u5E26\u51FA":o.value[y][n]==1?"\u65A4":o.value[y][n]==2?"\u516C\u65A4/\u5343\u514B":"\u5428"),1)):(d(),k("span",Ht,I(o.value[y][n]==null?"\u81EA\u52A8\u5E26\u51FA":o.value[y][n]),1))]))])}))]),1032,["columns","data-source","row-Selection","rowKey"]),s(W,null,{default:l(()=>[s(j,{span:10,style:{"text-align":"center"}},{default:l(()=>[s(x,{type:"primary",onClick:t[3]||(t[3]=n=>ae(1))},{default:l(()=>[f("\u4FDD\u5B58\u8349\u7A3F")]),_:1})]),_:1}),s(j,{span:4,style:{"text-align":"center"}},{default:l(()=>[s(x,{type:"primary",onClick:xe},{default:l(()=>[f("\u6E05\u7A7A\u6570\u636E")]),_:1})]),_:1}),s(j,{span:10,style:{"text-align":"center"}},{default:l(()=>[s(x,{type:"primary",onClick:t[4]||(t[4]=n=>ae(0))},{default:l(()=>[f("\u63D0\u4EA4\u8BA2\u5355")]),_:1})]),_:1})]),_:1}),s(re,{title:"\u4E0A\u4F20\u5408\u540C",visible:w.open,"onUpdate:visible":t[7]||(t[7]=n=>w.open=n),width:"400px","append-to-body":""},{footer:l(()=>[i("div",ta,[s(x,{type:"primary",onClick:pe},{default:l(()=>[f("\u786E \u5B9A")]),_:1}),s(x,{onClick:t[6]||(t[6]=n=>w.open=!1)},{default:l(()=>[f("\u53D6 \u6D88")]),_:1})])]),default:l(()=>[s(tt,{fileList:g.value,"onUpdate:fileList":t[5]||(t[5]=n=>g.value=n),type:"file",accept:".pdf,.doc,.docx",name:"file",maxCount:1,disabled:w.isUploading,beforeUpload:"false",drag:""},{default:l(()=>[i("p",Jt,[s(_(pt))]),ea]),_:1},8,["fileList","disabled"])]),_:1},8,["visible"])]),s(re,{title:V.value,visible:Q.value,"onUpdate:visible":t[8]||(t[8]=n=>Q.value=n),width:"800px",onOk:Me},{default:l(()=>[s(W,{gutter:24},{default:l(()=>[s(j,{span:8},{default:l(()=>[aa,i("div",na,[$.value&&$.value.length>0?(d(),h(at,{key:0,"tree-data":$.value,"field-names":{key:"id",title:"label",children:"children"},"expand-on-click-node":!1,ref:"deptTreeRef",defaultExpandAll:"",onSelect:ye,onExpand:he,expandedKeys:ee.value,showLine:""},{title:l(({title:n})=>[i("span",null,I(n),1)]),_:1},8,["tree-data","expandedKeys"])):(d(),k("div",oa,sa))])]),_:1}),s(j,{span:16},{default:l(()=>[s(ue,{dataSource:b.value,columns:_e.value,pagination:!1,style:{"margin-left":"0px"},"row-Selection":$e,rowKey:(n,v)=>v,class:"productTable"},{bodyCell:l(({column:n,record:v})=>[n.dataIndex==="measurementUnit"?(d(),h(nt,{key:0},{default:l(()=>[f(I(v.measurementUnit==1?"\u65A4":v.measurementUnit==2?"\u516C\u65A4":"\u5428"),1)]),_:2},1024)):T("",!0)]),_:1},8,["dataSource","columns","row-Selection","rowKey"])]),_:1})]),_:1})]),_:1},8,["title","visible"])],64)}}},pa=ot(ua,[["__scopeId","data-v-0421b232"]]);export{pa as default};
