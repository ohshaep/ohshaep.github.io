import{r,o as U,i as B,w as n,d as o,e as m,f as I,g as M,m as d,a6 as P,n as R,B as q,aJ as L,ac as V,s as E,M as S}from"./index.192c8708.js";import{u as T}from"./qualityReport.6dc17b5d.js";import{u as j}from"./artMag.f64bd10b.js";import{U as A}from"./UploadOutlined.4d52294f.js";const K={__name:"EditModal",emits:["refresh"],setup(J,{expose:_,emit:g}){const h=g,u=r(!1),p=r(),t=r([]),b={templateName:[{required:!0,message:"\u8BF7\u8F93\u5165\u8303\u672C\u540D\u79F0",trigger:"change"}],templateFiles:[{required:!0,validator:(a,e,v)=>t.value.length===0?Promise.reject("\u8BF7\u9009\u62E9\u9700\u8981\u4E0A\u4F20\u7684\u6587\u4EF6"):Promise.resolve(),trigger:"change"}]},k=a=>{console.log(a),T({file:a.file}).then(e=>{d.success("\u4E0A\u4F20\u6210\u529F"),console.log("\u4E0A\u4F20\u6210\u529F",e.data),t.value[t.value.length-1].fileInfo=e.data,console.log(t.value,"test"),a.onSuccess(e.data,a)}).catch(e=>{a.onError(e)})},l=r(),w=a=>{u.value=!0,l.value=a,t.value=[{name:a.filename}],console.log(a,"record"),console.log("edit",l.value)},x=async()=>{p.value.validate().then(a=>{if(a)try{l.value.filename=t.value[0].name,l.value.fileInfo=t.value[0].response,console.log(t.value[0],"fileList"),console.log(l.value,"modalInfo"),j(l.value).then(e=>{e.code===200&&(d.success("\u4FEE\u6539\u6210\u529F"),u.value=!1,h("refresh"))})}catch{}else return d.error("\u4FEE\u6539\u5931\u8D25\uFF0C\u8BF7\u586B\u5199\u5FC5\u586B\u9879"),!1})},f=()=>{l.value=[],u.value=!1};return _({showModal:w}),(a,e)=>{const v=P,i=R,c=q,C=L,y=V,F=E,N=S;return U(),B(N,{visible:u.value,title:"\u7F16\u8F91",onCancel:f,keyboard:!0,maskClosable:!1,cancelText:"\u5173\u95ED"},{footer:n(()=>[o(c,{onClick:f},{default:n(()=>[m("\u53D6\u6D88")]),_:1}),o(c,{type:"primary",onClick:x},{default:n(()=>[m("\u4FDD\u5B58\u4FEE\u6539")]),_:1})]),default:n(()=>[I("div",null,[o(F,{"label-col":{span:6},ref_key:"formRef",ref:p,model:l.value,rules:b},{default:n(()=>[o(i,{label:"\u8303\u672C\u540D\u79F0",name:"templateName"},{default:n(()=>[o(v,{value:l.value.templateName,"onUpdate:value":e[0]||(e[0]=s=>l.value.templateName=s),placeholder:"\u8BF7\u8F93\u5165\u8303\u672C\u540D\u79F0",style:{width:"250px"}},null,8,["value"])]),_:1}),o(i,{label:"\u8303\u672C\u6587\u4EF6",prop:"templateFiles"},{default:n(()=>[o(C,{name:"templateFiles","file-list":t.value,"onUpdate:fileList":e[1]||(e[1]=s=>t.value=s),maxCount:1,customRequest:k,onPreview:a.handlePreview},{default:n(()=>[o(c,{class:"upload-button"},{default:n(()=>[o(M(A)),m("\u70B9\u51FB\u4E0A\u4F20")]),_:1})]),_:1},8,["file-list","onPreview"])]),_:1}),o(i,{label:"\u8303\u672C\u8BF4\u660E"},{default:n(()=>[o(y,{value:l.value.remark,"onUpdate:value":e[2]||(e[2]=s=>l.value.remark=s),placeholder:"\u8BF7\u8F93\u5165\u8303\u672C\u8BF4\u660E",style:{width:"250px"}},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible"])}}};export{K as default};
