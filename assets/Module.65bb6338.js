var B=Object.defineProperty;var V=(t,e,a)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var S=(t,e,a)=>(V(t,typeof e!="symbol"?e+"":e,a),a);import{o as openBlock,c as createElementBlock,f as createBaseVNode,b5 as renderSlot,d as createVNode,ba as mergeProps,bi as __unplugin_components_0,bj as axios,bk as cookie,u as useRoute,A as reactive,at as computed,aO as watch,bl as changeHistoryState,r as ref,w as withCtx,g as unref,t as toDisplayString,Q as createCommentVNode,i as createBlock,F as Fragment,W as renderList,b6 as createSlots,e as createTextVNode,b7 as _sfc_main$5,bm as __unplugin_components_12,bn as Menu,bo as _sfc_main$6,x as __unplugin_components_9,bp as Checkbox,bq as __unplugin_components_2,z as _export_sfc,C as resolveComponent,bc as normalizeProps,bd as guardReactiveProps,br as __unplugin_components_0$1,bs as __unplugin_components_2$1,bt as userStore,bu as dictStore,bv as dayjs,bw as initHistoryParams,bx as ModalTip,m as message,aj as onMounted,l as _sfc_main$7,E as withKeys,a3 as _sfc_main$8,by as __unplugin_components_2$2,bz as _sfc_main$9}from"./index.192c8708.js";import{_ as __unplugin_components_3$1,a as __unplugin_components_4}from"./g-tooltip.68eea003.js";const _hoisted_1$1={class:"g-pagination"},_hoisted_2$1={class:"g-pagination-left"},_hoisted_3$1={class:"g-pagination-right"},_sfc_main$4={__name:"g-pagination",props:{current:{type:Number,default:1},pageSize:{type:Number,default:10},total:{type:Number,default:0}},emits:["update:current","update:pageSize","change"],setup(t,{emit:e}){const a=e,o={changePage(c,n){a("update:current",c),a("update:pageSize",n),a("change",c,n)}};return(c,n)=>{const u=__unplugin_components_0;return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[renderSlot(c.$slots,"left")]),createBaseVNode("div",_hoisted_3$1,[createVNode(u,mergeProps({current:t.current,pageSize:t.pageSize,size:"small",total:t.total,"show-size-changer":"","show-quick-jumper":"","show-total":r=>`\u5171${r}\u6761`,onChange:o.changePage},c.$attrs),null,16,["current","pageSize","total","show-total","onChange"])])])}}};class Axios{constructor(e){S(this,"instance");S(this,"baseURL");S(this,"headers");S(this,"timeout");S(this,"requestInstance");S(this,"responseInstance");this.baseURL=e.baseURL||void 0,this.headers=e.headers||{"Content-Type":"application/json"},this.timeout=e.timeout||9e4,this.init()}async init(){this.instance=axios.create({baseURL:this.baseURL,headers:this.headers,timeout:this.timeout}),this.requestInstance=this.instance.interceptors.request.use(function(e){return e},function(e){return Promise.reject(e)}),this.responseInstance=this.instance.interceptors.response.use(function(e){const{data:a}=e;return a},function(e){var a;try{if(/401/.test(e.response.status)){cookie.delete("token"),window.location.reload();return}return(e==null?void 0:e.response)&&((a=e==null?void 0:e.response)==null?void 0:a.data)||{}}catch{return e.response}})}request(e){return this.instance.request(e)}resetRequest(e,a){this.instance.interceptors.request.eject(this.requestInstance),this.requestInstance=this.instance.interceptors.request.use(e,a)}resetResponse(e,a){this.instance.interceptors.response.eject(this.responseInstance),this.responseInstance=this.instance.interceptors.response.use(e,a)}}function tableMixins(){const $useRoute=useRoute(),DEFAULT_PAGENO=1,DEFAULT_PAGESIZE=10,axios=new Axios({baseURL:"http://113.108.106.175:81",headers:{"Content-Type":"application/json"}}),tableState=reactive({url:"",checkedAll:!1,selectedRowKeys:[],selectedRows:[],loading:!1,dataSource:[],rowKey:"id",rowSelectionType:"checkbox",scroll:{x:1200},queryParams:{},isFirstRender:!1}),paginationState=reactive({current:DEFAULT_PAGENO,pagesize:DEFAULT_PAGESIZE,total:0,pageSizeOptions:["10","20","30"],showQuickJumper:!0,showSizeChanger:!0,showTotal:(t,e)=>" \u5171"+t+"\u6761"}),rowSelection=computed(()=>{let{selectedRowKeys}=tableState;return{selectedRowKeys,hideDefaultSelections:!0,hideSelectAll:!0,type:computed(()=>tableState.rowSelectionType),onChange:(selectedRowKeys,selectedRows)=>{let rowKey=tableState.rowKey;tableState.selectedRows=selectedRows,tableState.selectedRowKeys=selectedRows.map((item,index)=>rowKey=="index"?index:eval(`item.${rowKey}`)),tableState.checkedAll=selectedRows.length==tableState.dataSource.length},onSelect:(t,e,a)=>{},onSelectAll:(t,e,a)=>{}}}),tableMethods={getTable(t){if(!tableState.url)return;t&&typeof t=="number"&&!tableState.isFirstRender&&(paginationState.current=t,tableState.isFirstRender=!1),tableState.loading=!0,tableState.dataSource=[];const e=tableState.method=="get"?"parmas":"data";axios.request({url:tableState.url,method:tableState.method,[e]:{...tableMethods.disposeParams(JSON.parse(JSON.stringify(tableState.queryParams))),pageNo:paginationState.pageNo,pageSize:paginationState.pageSize}}).then(a=>{var c;let o=a.data||{};if(tableState.total=o.total||0,!((c=o.records)!=null&&c.length)&&paginationState.pageNo>1&&o.total!==void 0){let n=tableMethods.isExceedMaximumPage(paginationState.current);if(n<paginationState.current){tableMethods.getTable(n);return}}else tableState.dataSource=o.records||[];tableState.selectedRowKeys=[],tableState.selectedRows=[]}).finally(()=>{tableState.loading=!1})},searchQuery(t={}){t=JSON.stringify(t);let e=JSON.stringify(tableState.queryParams);t==e?tableMethods.getTable(paginationState.current):(tableState.queryParams=JSON.parse(t),tableMethods.getTable(DEFAULT_PAGENO))},paginationChange(t,e){t&&typeof t=="number"&&(paginationState.current=t),e&&typeof e=="number"&&(paginationState.pageSize=e),changeHistoryState({pageNo:paginationState.current,pageSize:paginationState.pageSize}),tableMethods.getTable(paginationState.current)},disposeParams(t){return t instanceof Object?(Object.keys(t).forEach(e=>{t[e]instanceof Object&&(t[e]=tableMethods.disposeParams(t[e])),typeof t[e]=="string"&&(t[e]=t[e]||t[e]=="0"?t[e].trim():void 0)}),t):typeof t=="string"?t.trim():t},checkAllHandler({target}){target.checked?(tableState.selectedRowKeys=tableState.dataSource.map(item=>eval(`item.${tableState.rowKey}`)),tableState.selectedRows=[...tableState.dataSource]):(tableState.selectedRowKeys=[],tableState.selectedRows=[])},isExceedMaximumPage(t){let e=Math.ceil(paginationState.total/paginationState.pageSize);return t>e&&paginationState.total>0?e:t},setDataSource(t){tableState.dataSource=t||[],paginationState.total=tableState.dataSource.length,paginationState.current=tableMethods.isExceedMaximumPage(paginationState.current)},rowKey:record=>eval(`record.${tableState.rowKey}`)};return watch(()=>$useRoute,t=>{let{pageNo:e,pageSize:a}=t.query;(e||a)&&(paginationState.current=!!Number(e)&&Number(e)||DEFAULT_PAGENO,paginationState.pageSize=!!Number(a)&&Number(a)||DEFAULT_PAGESIZE,tableState.isFirstRender=!0)},{immediate:!0,deep:!0}),{tableState,paginationState,rowSelection,tableMethods}}const _hoisted_1={key:0,class:"sort_body"},_hoisted_2=["onClick"],_hoisted_3={class:"sort_icon_body"},_hoisted_4=["onClick"],_hoisted_5={style:{display:"flex","align-items":"center"}},_hoisted_6=createBaseVNode("span",{style:{"padding-left":"16px"}},"\u5168\u9009",-1),_sfc_main$3={__name:"g-table",props:{url:{type:String,default:""},method:{type:String,default:"get"},columns:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},showSelection:{type:Boolean,default:!1},action:{type:Boolean,default:!0},customAction:{type:Boolean,default:!1},overlayMenu:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["update:loading"],setup(t,{expose:e,emit:a}){const o=t,c=ref(),{tableState:n,paginationState:u,tableMethods:r,rowSelection:s}=tableMixins();n.columns=computed(()=>{const i=[...o.columns];return o.action&&!i.some(d=>d.key=="action")&&i.push({title:"\u64CD\u4F5C",fixed:"right",key:"action",width:80}),i}),n.overlayMenu=computed(()=>i=>o.overlayMenu.filter(d=>l.disposeDropdownMent(d==null?void 0:d.show,i,!0))),n.sort=computed(()=>{let i={};return n.sortRecord=void 0,o.columns.forEach(d=>{d.sort&&(n.sortRecord||(n.sortRecord={key:d.title,isAsc:!0}),i[d.title]=d)}),i});const h=a,l=Object.assign(r,{init(){watch(()=>[o.rowKey,o.url,o.method,o.loading],([i,d,_,y])=>{n.rowKey=i,n.url=d,n.method=_,n.loading=y},{immediate:!0,deep:!0}),watch(()=>n.loading,i=>{h("update:loading",i)})},getSelection(){return{selectedRows:n.selectedRows,selectedRowKeys:n.selectedRowKeys}},batchDelete(){console.log("selectedRows",n.selectedRows),console.log("selectedRowKeys",n.selectedRowKeys)},disposeDropdownMent(i,d,_=!1){return typeof i=="boolean"?i:typeof i=="function"?i(d):_}});return l.init(),e({searchQuery:l.searchQuery,setDataSource:l.setDataSource,getSelectionRow:l.getSelectionRow}),(i,d)=>{const _=_sfc_main$5,y=__unplugin_components_12,v=Menu,C=_sfc_main$6,p=__unplugin_components_9,g=Checkbox,w=__unplugin_components_2,N=_sfc_main$4;return openBlock(),createElementBlock(Fragment,null,[createVNode(p,{class:"g-table",ref_key:"tableRef",ref:c,rowKey:unref(l).rowKey,loading:unref(n).loading,columns:unref(n).columns,dataSource:unref(n).dataSource,scroll:unref(n).scroll,rowSelection:t.showSelection?unref(s):void 0,pagination:!1},{headerCell:withCtx(({title:m,column:b})=>{var k;return[(k=unref(n))!=null&&k.sort[m]?(openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("span",{class:"sort_text",onClick:x=>unref(l).changeSort(m)},toDisplayString(m),9,_hoisted_2),createBaseVNode("div",_hoisted_3,[createVNode(_,{style:{transform:"rotate(180deg)"},isSvg:"",icon:unref(n).sortRecord.key==m&&unref(n).sortRecord.isAsc?"icon-a-lujing1":"icon-lujing",size:"12",onClick:x=>unref(l).changeSort(m,!0)},null,8,["icon","onClick"]),createVNode(_,{isSvg:"",icon:unref(n).sortRecord.key==m&&!unref(n).sortRecord.isAsc&&typeof unref(n).sortRecord.isAsc=="boolean"?"icon-a-lujing1":"icon-lujing",size:"12",onClick:x=>unref(l).changeSort(m,!1)},null,8,["icon","onClick"])])])):createCommentVNode("",!0)]}),bodyCell:withCtx(({column:m,record:b,index:k,text:x,value:$})=>[m.key=="action"&&!t.customAction?(openBlock(),createBlock(C,{key:0,placement:"bottomRight"},{overlay:withCtx(()=>[createVNode(v,{class:"g-dropdown-menu"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(n).overlayMenu(b),(f,M)=>(openBlock(),createBlock(y,{key:M,icon:f.icon,disabled:unref(l).disposeDropdownMent(f==null?void 0:f.disabled,b,!1)},createSlots({default:withCtx(()=>[createBaseVNode("a",{href:"javascript:;",onClick:A=>{var R;return(R=f.handler)==null?void 0:R.call(f,b)}},toDisplayString(f.label),9,_hoisted_4)]),_:2},[f.icon?{name:"icon",fn:withCtx(()=>[createVNode(_,{icon:f.icon,style:{"margin-right":"8px"}},null,8,["icon"])]),key:"0"}:void 0]),1032,["icon","disabled"]))),128))]),_:2},1024)]),default:withCtx(()=>[createVNode(_,{size:"15",icon:"icon-caozuo",style:{cursor:"pointer"}})]),_:2},1024)):createCommentVNode("",!0),renderSlot(i.$slots,"bodyCell",{column:m,record:b,index:k,text:x,value:$})]),_:3},8,["rowKey","loading","columns","dataSource","scroll","rowSelection"]),createVNode(N,{current:unref(u).current,pageSize:unref(u).pageSize,total:unref(u).total,"show-total":unref(u).showTotal,"show-size-changer":unref(u).showSizeChanger,"show-quick-jumper":unref(u).showQuickJumper,onChange:unref(l).paginationChange},createSlots({_:2},[t.showSelection?{name:"left",fn:withCtx(()=>[createBaseVNode("div",_hoisted_5,[createVNode(g,{checked:unref(n).checkedAll,"onUpdate:checked":d[0]||(d[0]=m=>unref(n).checkedAll=m),onChange:unref(l).checkAllHandler},{default:withCtx(()=>[_hoisted_6]),_:1},8,["checked","onChange"]),createVNode(w,{style:{"margin-left":"20px"},onClick:unref(l).batchDelete},{default:withCtx(()=>[createTextVNode("\u5220\u9664")]),_:1},8,["onClick"])])]),key:"0"}:void 0]),1032,["current","pageSize","total","show-total","show-size-changer","show-quick-jumper","onChange"])],64)}}},_sfc_main$2={};function _sfc_render(t,e){const a=resolveComponent("router-link");return openBlock(),createBlock(a,normalizeProps(guardReactiveProps(t.$attrs)),{default:withCtx(()=>[renderSlot(t.$slots,"default")]),_:3},16)}const __unplugin_components_3=_export_sfc(_sfc_main$2,[["render",_sfc_render]]),stringSort=(dataSource,isAsc,key)=>{let list=[],sortList=[];return(dataSource||[]).forEach(item=>{let text=eval(`item.${key}`)||"",code=/^[a-zA-Z].*/.test(text)?text.charCodeAt():0;code>=97&&(code-=96),code>=65&&(code-=64),list[code]?list[code].push(item):list[code]=[item]}),list.forEach(t=>{t&&(sortList=[...sortList,...t])}),isAsc?sortList:sortList.reverse()},_sfc_main$1={__name:"YamlModal",emits:["ok"],setup(t,{expose:e,emit:a}){const o=reactive({visible:!1,value:"",readOnly:!1,downloadName:"default.deployment.yaml"}),c=reactive({cluster:"",name:"createDeployments",namespace:"cmp",params:{namespace:"cmp",name:void 0},body:{}}),n={showModal(u){const{record:r={},title:s,readOnly:h=!1}=u;o.visible=!0,o.value="",o.title=s,o.readOnly=h,Object.keys(c).forEach(l=>{c[l]=r[l]})},onSubmit(){o.visible=!1}};return e({showModal:n.showModal}),(u,r)=>{const s=__unplugin_components_0$1,h=__unplugin_components_2$1;return openBlock(),createBlock(h,{visible:unref(o).visible,"onUpdate:visible":r[1]||(r[1]=l=>unref(o).visible=l),title:unref(o).title,large:"",onOk:n.onSubmit},{default:withCtx(()=>[unref(o).visible?(openBlock(),createBlock(s,{key:0,value:unref(o).value,"onUpdate:value":r[0]||(r[0]=l=>unref(o).value=l),readOnly:unref(o).readOnly,showUpload:!unref(o).readOnly,downloadName:"\u4E0B\u8F7D.yml",style:{height:"100%"}},null,8,["value","readOnly","showUpload"])):createCommentVNode("",!0)]),_:1},8,["visible","title","onOk"])}}},_sfc_main={__name:"Module",setup(t){userStore();const e=dictStore(),a=ref(),o=ref(),c=reactive({loading:!1,columns:[{title:"\u540D\u79F0",key:"name",sort:!0,customSort:(r,s)=>stringSort(r,s,"metadata?.name")},{title:"\u547D\u540D\u7A7A\u95F4",dataIndex:"namespace",sort:!0,customSort:(r,s)=>stringSort(r,s,"metadata?.namespace")},{title:"\u72B6\u6001",key:"status"},{title:"\u521B\u5EFA\u4FE1\u606F",dataIndex:"creationTimestamp",customRender:({text:r})=>r?dayjs(r).format("YYYY-MM-DD HH:mm:ss"):"-"}],overlayMenu:[{label:"yaml",handler:()=>u.showModify({title:"yaml"})},{label:"\u5220\u9664",handler:r=>u.delete(r)}]}),n=reactive(initHistoryParams({namespace:void 0,type:void 0,status:void 0,name:void 0}));e.update("namespace",[{label:"cmp",value:"cmp"}],{label:"label",value:"value"});const u={searchQuery(){console.log("queryParams",n),changeHistoryState(n),unref(a).setDataSource([{name:"example",namespace:"cmp",creationTimestamp:new Date}])},showModify(r){unref(o).showModal(r)},delete(r){ModalTip.confirm({title:"\u786E\u8BA4\u5220\u9664",icon:"icon-shanchu",iconProps:{isSvg:!0,class:"mr-10px"},okButtonProps:{pattern:"error"},content:createVNode("div",{},[createVNode("div",{style:"margin-bottom: 12px; font-weight: 700;font-size: 16px"},["\u786E\u8BA4\u5220\u9664\u8BE5\u8BBE\u65BD\uFF1F"])]),onOk:()=>new Promise((s,h)=>{r.name==value?(message.success("\u5220\u9664\u6210\u529F\uFF01"),s()):(message.warning("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u793A\u4F8B\u540D\u79F0\uFF01"),h())})})}};return onMounted(()=>{u.searchQuery()}),(r,s)=>{const h=_sfc_main$8,l=__unplugin_components_2,i=__unplugin_components_2$2,d=__unplugin_components_3,_=__unplugin_components_3$1,y=__unplugin_components_4,v=_sfc_main$3,C=_sfc_main$9;return openBlock(),createBlock(C,null,{header:withCtx(()=>[createVNode(i,{loading:unref(c).loading,onSearch:s[5]||(s[5]=p=>u.searchQuery())},{right:withCtx(()=>[createVNode(l,{type:"primary",onClick:s[4]||(s[4]=p=>u.showModify({title:"\u521B\u5EFA"}))},{default:withCtx(()=>[createTextVNode("\u65B0\u589E")]),_:1})]),default:withCtx(()=>[createVNode(h,{value:unref(n).namespace,"onUpdate:value":s[0]||(s[0]=p=>unref(n).namespace=p),width:"168",placeholder:"\u547D\u540D\u7A7A\u95F4",label:"\u547D\u540D\u7A7A\u95F4",allowClear:"",dictCode:"namespace",onChange:s[1]||(s[1]=p=>u.searchQuery())},null,8,["value"]),createVNode(_sfc_main$7,{value:unref(n).name,"onUpdate:value":s[2]||(s[2]=p=>unref(n).name=p),width:"168px",search:"",label:"1111",placeholder:"\u8F93\u5165\u540D\u79F0\u8FDB\u884C\u641C\u7D22111...",onKeydown:s[3]||(s[3]=withKeys(p=>u.searchQuery(),["enter"]))},null,8,["value"])]),_:1},8,["loading"])]),default:withCtx(()=>[createVNode(v,{ref_key:"tableRef",ref:a,url:"/list",method:"get",rowKey:"namespace",loading:unref(c).loading,"onUpdate:loading":s[6]||(s[6]=p=>unref(c).loading=p),columns:unref(c).columns,overlayMenu:unref(c).overlayMenu},{bodyCell:withCtx(({column:p,record:g})=>{var w;return[p.key=="name"?(openBlock(),createBlock(_,{key:0},createSlots({default:withCtx(()=>[createVNode(d,{to:`/detail/cluster/namespace/kind/${g.name}`},{default:withCtx(()=>[createTextVNode(toDisplayString(g.name),1)]),_:2},1032,["to"])]),_:2},[(w=g==null?void 0:g.metadata)!=null&&w.name?{name:"title",fn:withCtx(()=>[createTextVNode(toDisplayString(g.name),1)]),key:"0"}:void 0]),1024)):createCommentVNode("",!0),p.key=="status"?(openBlock(),createBlock(y,{key:1,pattern:"primary"},{default:withCtx(()=>[createTextVNode(toDisplayString("\u8FD0\u884C\u4E2D"))]),_:1})):createCommentVNode("",!0)]}),_:1},8,["loading","columns","overlayMenu"]),createVNode(_sfc_main$1,{ref_key:"yamlModalRef",ref:o},null,512)]),_:1})}}};export{_sfc_main as default};
