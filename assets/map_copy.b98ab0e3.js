import{z as R,af as z,aV as E,bE as x,bF as N,bG as U,bH as D,bI as j,bJ as B,bK as P,bL as G,m as X,C as F,o as u,c as m,d as p,w as f,f as a,F as k,W as I,i as A,e as v,t as d,h as S,Q as C,bM as L,D as T,a8 as H,a9 as W,b1 as Z,B as J,y as K,M as Q,N as Y,O as q}from"./index.192c8708.js";const $=""+new URL("ding_add.33df84f9.png",import.meta.url).href;let w;const ee={name:"Map",components:{CommonLine:z,RightOutlined:E},data(){return{map:null,range:!1,ruler1:null,addFacility:!1,moveFacility:!1,type:"",typeList:[{value:"",label:"\u5168\u90E8"},{value:"BOX",label:"\u5149\u4EA4\u7BB1"},{value:"ODF",label:"odf\u67B6"},{value:"TERMINAL",label:"\u5149\u7EA4\u7EC8\u7AEF\u76D2"},{value:"FUSION",label:"\u7194\u63A5\u5305"}],searchvalue:[],renfang:[{value:[121.20261,31.06125],type:0,number:"112312",name:"\u5149\u4EA4\u7BB11",name2:"\u65B0\u6865",address:"\u65B0\u6865"},{value:[121.28468,31.08859],type:0,number:"665977",name:"\u5149\u4EA4\u7BB12",name2:"\u65B0\u68651",address:"\u65B0\u68651"}],jingbao:[{value:[121.23674,30.98917],type:1,number:"668978",name:"odf\u67B61",name2:"\u677E\u6C5F\u5357",address:"\u677E\u6C5F\u5357"},{value:[121.21771,30.99077],type:1,number:"567457",name:"odf\u67B62",name2:"\u677E\u6C5F\u5357",address:"\u677E\u6C5F\u5357"}],addForm:{lng:"",lat:"",address:"",adcode:""},addVisible:!1,setVisible:!1,addOptcol:null,addAddressObj:{lng:null,lat:null,address:"",houseNumber:""},marksList:[],detailVisible:!1,dragendVisible:!1,dragendL:"0px",dragendT:"0px",dragendData:{},sceneImgList:[{url:"https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png"},{url:"https://t7.baidu.com/it/u=3344069233,1239888910&fm=193&f=GIF"},{url:"https://t7.baidu.com/it/u=3544479903,839840892&fm=193&f=GIF"},{url:"https://t7.baidu.com/it/u=4275911202,3562923337&fm=193&f=GIF"},{url:"https://t7.baidu.com/it/u=473920583,34141612&fm=193&f=GIF"}],sceneShort:[],hackReset:!0,facilityList:[],infrastructureInfo:{imagesInfoResps:[],tackUpInfrastructures:[]},fetching:!1,ssdata:[],lastFetchId:0}},created(){},watch:{type(){this.type,this.getGdMap()},range(){this.range?this.ruler1.turnOn():this.ruler1.turnOff()}},mounted(){this.getGdMap()},methods:{toDetail(t,e){const{id:i,version:l}=t;this.$router.push(`/geo/map-detail/index/${i}/${l}`+(e?"?isRoute=true":"?isRoute=false"))},async fetchList(){this.map.getAdcode();const{lat:t,lng:e}=this.map.getCenter();let i={};this.type===""?this.searchvalue&&(i.name=this.searchvalue):(i.type=this.type,this.searchvalue&&(i.name=this.searchvalue)),i.centerLongitude=e,i.centerLatitude=t;const l=await x(i);if((l==null?void 0:l.code)===200){const s=(l==null?void 0:l.data)||[];this.facilityList=s,this.addMask()}},handleSetClose(t){t||console.log(111),this.setVisible=!1,this.hackReset=!1,this.$nextTick(()=>{this.hackReset=!0})},handlePreview(t,e){this.$preview(e,t,"url")},getAddress(t,e){N(t,e).then(({data:i})=>{if(!i.citycode)return Promise.reject();this.addAddressObj={address:i==null?void 0:i.formattedAddress,houseNumber:i==null?void 0:i.number,lng:t,lat:e,adcode:i==null?void 0:i.adcode,citycode:i==null?void 0:i.citycode,province:i==null?void 0:i.province}}).catch(()=>{let i=this.map.getAdcode();console.log(i+"-----------------------"),console.log("this.map---",this.map,t,e);let l=`${t},${e}`;new AMap.Geocoder({radius:1e3}).getAddress(l,(n,r)=>{if(n==="complete"&&r.regeocode){console.log(r);let c=r.regeocode.addressComponent,h=c.province+"-"+c.city+"-"+c.district,_=r.regeocode.formattedAddress;_.substring(h.length);const{adcode:y,province:M}=c;this.addAddressObj={address:_,houseNumber:`${c.street}${c.streetNumber}`,lng:t,lat:e,adcode:y,citycode:i,province:43e4}}})})},handleAddOk(){this.setVisible=!0},onSearch(t){return new Promise((e,i)=>{w&&(clearTimeout(w),w=null);let l=this;async function s(){l.map.getAdcode();let n={};n.name=t,n.type=l.type||void 0,console.log(n);const r=await x(n);(r==null?void 0:r.code)===200&&(l.ssdata=(r==null?void 0:r.data)||[],e((r==null?void 0:r.data)||[]))}w=setTimeout(s,300)})},async handleChange(t){this.searchvalue=t,t.length?(this.facilityList=t.map(e=>this.ssdata.find(i=>i.id==e)),console.log(t,this.facilityList),this.addMask()):await this.onSearch()&&this.addMask()},onChange(t){},handleDrag(t){this.marksList.forEach(e=>{e.setDraggable(t)})},handleTool(t,e){t?e==="range"?(this.range=!0,this.addFacility=!1,this.moveFacility=!1,this.handleDrag(!1)):e==="addFacility"?(this.range=!1,this.addFacility=!0,this.moveFacility=!1,this.handleDrag(!1)):(this.range=!1,this.addFacility=!1,this.moveFacility=!0,this.handleDrag(!0)):e==="moveFacility"&&this.handleDrag(!1)},getGdMap(){var t=this;t.map=new AMap.Map(this.$refs.allmap,{scrollWheel:!0,viewMode:"2D",resizeEnable:!0,zoom:13,maxZoom:30,minZoom:2,zooms:[3,18]}),t.map.on("click",c=>{if(this.detailVisible=!1,!t.addFacility)return;t.addForm.lng=c.lnglat.lng,t.addForm.lat=c.lnglat.lat;let{lng:h,lat:_}=c.lnglat;t.addVisible=!0,t.getAddress(h,_)});let e=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,maximumAge:0,noIpLocate:0,convert:!0,showButton:!1,buttonPosition:"RB",showMarker:!1,showCircle:!0,panToLocation:!0,zoomToAccuracy:!0,extensions:"all",pName:"Geolocation"});t.map.addControl(e),e.getCurrentPosition(function(c,h){console.log(c,h,"statusresult"),c=="complete"?t.onComplete(h):console.log(h.message)});var i={icon:new AMap.Icon({size:new AMap.Size(19,31),imageSize:new AMap.Size(19,31),image:"https://webapi.amap.com/theme/v1.3/markers/b/start.png"})},l={icon:new AMap.Icon({size:new AMap.Size(19,31),imageSize:new AMap.Size(19,31),image:"https://webapi.amap.com/theme/v1.3/markers/b/end.png"}),offset:new AMap.Pixel(-9,-31)},s={icon:new AMap.Icon({size:new AMap.Size(19,31),imageSize:new AMap.Size(19,31),image:"https://webapi.amap.com/theme/v1.3/markers/b/mid.png"}),offset:new AMap.Pixel(-9,-31)},n={strokeStyle:"solid",strokeColor:"#FF33FF",strokeOpacity:1,strokeWeight:2},r={startMarkerOptions:i,midMarkerOptions:s,endMarkerOptions:l,lineOptions:n};t.ruler1=new AMap.RangingTool(t.map,r),t.fetchList()},onComplete(t){document.getElementById("status").innerHTML="\u5B9A\u4F4D\u6210\u529F";var e=[];e.push("\u5B9A\u4F4D\u7ED3\u679C\uFF1A"+t.position),e.push("\u5B9A\u4F4D\u7C7B\u522B\uFF1A"+t.location_type),t.accuracy&&e.push("\u7CBE\u5EA6\uFF1A"+t.accuracy+" \u7C73"),e.push("\u662F\u5426\u7ECF\u8FC7\u504F\u79FB\uFF1A"+(t.isConverted?"\u662F":"\u5426")),document.getElementById("result").innerHTML=e.join("<br>")},addMask(){this.map.remove(this.marksList),this.facilityList.length>0&&this.facilityList.forEach(t=>{this.addMarker(t.longitude,t.latitude,t)})},getclear(){var t=this;let e=t.map.getAllOverlays();for(var i=0;i<e.length;i++)t.map.remove(e[i])},handleClose(t){this.setVisible=!1,this.addVisible=!1;const{type:e,latitude:i,longitude:l}=t;this.type=e,this.map.setCenter([l,i]),this.fetchList()},async markerClick(t){const e=t.target.getExtData()||"";this.fetchDetail(e)},async markerDragending(t){this.dragendL=t.pixel.x-20+"px",this.dragendT=t.pixel.y+"px",this.dragendData=t.lnglat;let e=`${t.lnglat.lng},${t.lnglat.lat}`;new AMap.Geocoder({radius:1e3}).getAddress(e,(l,s)=>{if(l==="complete"&&s.regeocode){let n=s.regeocode.addressComponent;n.province+""+n.city+n.district;let r=s.regeocode.formattedAddress;this.dragendData.addreesd=r}})},async markerDragend(t){const e=t.target.getExtData()||"";this.fetchDetail(e,"dragend")},async fetchDetail(t,e){var l;const i=await U(t);if((i==null?void 0:i.success)&&i.data){e==="dragend"?this.dragendVisible=!0:this.detailVisible=!0,this.infrastructureInfo=i==null?void 0:i.data;let s=((l=this.infrastructureInfo)==null?void 0:l.imagesInfoResps)||[];if(s.length>0){let n=imageUrl;s.forEach(r=>{r.url=`${n}${r.filePath}`})}}},addMarker(t,e,i){var l=new AMap.Marker({icon:D,position:[t,e],offset:new AMap.Pixel(-50,-30),extData:i.id});l.on("click",this.markerClick);var s=document.createElement("div"),n=document.createElement("img");n.class="markerlnglat",n.width="30",n.height="30",this.addFacility?n.src=$:(i.type=="BOX"&&(n.src=D),i.type=="ODF"&&(n.src=j),i.type=="TERMINAL"&&(n.src=B),i.type=="FUSION"&&(n.src=P)),l.on("dragend",this.markerDragend),l.on("dragging",this.markerDragending),s.appendChild(n);var r=document.createElement("span");r.class="marker",s.appendChild(r),l.setPosition([t,e]),l.setContent(s),this.addFacility||l.setLabel({offset:new AMap.Pixel(0,-6),content:`<div class="info-label">${i.name} \u3010${i.type==="BOX"?"\u5149\u4EA4\u7BB1":i.type==="ODF"?"odf\u67B6":i.type==="TERMINAL"?"\u5149\u7EA4\u7EC8\u7AEF\u76D2":"\u7194\u63A5\u5305"}\u3011</div>`,direction:"top"}),l.setMap(this.map),this.marksList.push(l)},async saveDragend(){let t={longitude:this.dragendData.lng,latitude:this.dragendData.lat,address:this.dragendData.addreesd};const e=await G(t,this.infrastructureInfo.id,this.infrastructureInfo.version);e!=null&&e.success&&(this.dragendVisible=!1,X.success("\u4FDD\u5B58\u6210\u529F"),this.fetchDetail(this.infrastructureInfo.id))}}},g=t=>(Y("data-v-150985b1"),t=t(),q(),t),te={class:"maps"},se={class:"type-box"},ie={class:"search-box"},ae={class:"info"},ne=g(()=>a("div",{class:"info-top"},"\u5DE5\u5177\u7BB1",-1)),oe={class:"item-box dis-center-between",style:{"padding-top":"6px"}},le=g(()=>a("span",{class:"infoTitle"},"\u6D4B\u8DDD",-1)),re={class:"item-box dis-center-between"},de=g(()=>a("span",{class:"infoTitle"},"\u6DFB\u52A0\u8BBE\u65BD",-1)),ce={class:"item-box dis-center-between",style:{"padding-bottom":"8px"}},ue=g(()=>a("span",{class:"infoTitle"},"\u79FB\u52A8\u8BBE\u65BD",-1)),he={class:"detail-box"},pe={class:"top-box"},me={class:"title vertical-center"},fe={class:"ellipsis name"},ge={class:"address"},_e={class:"num-address"},ve={class:"type"},ye={class:"line-box"},be={class:"line-item dis-center-between"},ke=g(()=>a("div",{class:"label"},"\u573A\u6240",-1)),Ie={class:"value"},we={class:"line-item dis-center-between"},Ae=g(()=>a("div",{class:"label"},"\u8857\u666F",-1)),Ce={class:"value"},Me={key:0,class:"iconfont icon-xiangyou1"},Oe=g(()=>a("span",{style:{"font-size":"12px",color:"#ccc"}},"\u6682\u65E0\u56FE\u7247",-1)),xe={key:0,class:"line-img"},De={class:"dis-center-around"},Fe=["onClick"],Se=["src"],Le=g(()=>a("div",{class:"label"},"\u5149\u7EA4\u8DEF\u7531",-1)),Te=g(()=>a("div",{class:"value"},[a("span",{class:"iconfont icon-xiangyou1"})],-1)),Ve=[Le,Te],Re={class:"des-box"},ze={class:"item-top"},Ee={class:"item-bottom"},Ne={class:"scan-btn"},Ue={class:"dragend-title"},je={class:"dragend-wnse"},Be={class:"dragend-name"},Pe={ref:"allmap",class:"bodymap"};function Ge(t,e,i,l,s,n){const r=H,c=W,h=Z,_=F("right-outlined"),y=J,M=K,O=Q,V=F("CommonLine");return u(),m("div",null,[p(M,{class:"main-body-deepen"},{default:f(()=>[a("div",te,[a("div",se,[p(c,{value:s.type,"onUpdate:value":e[0]||(e[0]=o=>s.type=o),class:"m-2",placeholder:"Select",size:"large"},{default:f(()=>[(u(!0),m(k,null,I(s.typeList,o=>(u(),A(r,{key:o.value,value:o.value},{default:f(()=>[v(d(o.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),a("div",ie,[p(c,{value:s.searchvalue,mode:"multiple",placeholder:"\u8BF7\u8F93\u5165\u60A8\u8981\u67E5\u8BE2\u7684\u5185\u5BB9","enter-button":"","filter-option":!1,"show-search":"",style:{width:"200px"},"default-active-first-option":!1,"show-arrow":!1,"not-found-content":null,onSearch:n.onSearch,onChange:n.handleChange},{default:f(()=>[(u(!0),m(k,null,I(s.ssdata,o=>(u(),A(r,{key:o.id},{default:f(()=>[v(d(o.name),1)]),_:2},1024))),128))]),_:1},8,["value","onSearch","onChange"])]),a("div",ae,[ne,a("div",oe,[le,p(h,{onChange:e[1]||(e[1]=o=>n.handleTool(o,"range")),size:"small",checked:s.range,"onUpdate:checked":e[2]||(e[2]=o=>s.range=o)},null,8,["checked"])]),a("div",re,[de,p(h,{onChange:e[3]||(e[3]=o=>n.handleTool(o,"addFacility")),size:"small",checked:s.addFacility,"onUpdate:checked":e[4]||(e[4]=o=>s.addFacility=o)},null,8,["checked"])]),a("div",ce,[ue,p(h,{onChange:e[5]||(e[5]=o=>n.handleTool(o,"moveFacility")),size:"small",checked:s.moveFacility,"onUpdate:checked":e[6]||(e[6]=o=>s.moveFacility=o)},null,8,["checked"])])]),S(a("div",he,[a("div",pe,[a("div",me,[a("span",fe,d(s.infrastructureInfo.name),1),a("span",null,"\uFF08"+d(s.infrastructureInfo.verifyStatus==="VERIFY_INIT_STATUS"?"\u5BA1\u6838\u4E2D":s.infrastructureInfo.verifyStatus==="SUCCESS_STATUS"?"\u5BA1\u6279\u901A\u8FC7":"\u5BA1\u6279\u672A\u901A\u8FC7")+"\uFF09",1)]),a("div",ge,d(s.infrastructureInfo.address),1),a("div",_e," \u7ECF\u5EA6\uFF1A"+d(s.infrastructureInfo.longitude)+" \uFF0C\u7EAC\u5EA6\uFF1A"+d(s.infrastructureInfo.latitude),1),a("div",ve,d(s.infrastructureInfo.type==="BOX"?"\u5149\u4EA4\u7BB1":s.infrastructureInfo.type==="ODF"?"odf\u67B6":s.infrastructureInfo.type==="TERMINAL"?"\u5149\u7EA4\u7EC8\u7AEF\u76D2":"\u7194\u63A5\u5305"),1)]),a("div",ye,[a("div",be,[ke,a("div",Ie,d(s.infrastructureInfo.placeName),1)]),a("div",we,[Ae,a("div",Ce,[s.infrastructureInfo.imagesInfoResps.length>0?(u(),m("span",Me)):C("",!0),Oe])]),s.infrastructureInfo.imagesInfoResps.length>0?(u(),m("div",xe,[a("div",De,[(u(!0),m(k,null,I(s.infrastructureInfo.imagesInfoResps,(o,b)=>(u(),m("div",{class:"img-box",key:b,onClick:Xe=>n.handlePreview(s.infrastructureInfo.imagesInfoResps,b)},[a("img",{src:o.url,alt:""},null,8,Se)],8,Fe))),128))])])):C("",!0),a("div",{class:"line-item line-hover dis-center-between",style:L({borderTop:s.infrastructureInfo.imagesInfoResps.length>0?"1px solid #f0f0f0":"none"}),onClick:e[7]||(e[7]=o=>n.toDetail(s.infrastructureInfo,!0))},Ve,4)]),a("div",Re,[(u(!0),m(k,null,I(s.infrastructureInfo.tackUpInfrastructures.slice(0,10),(o,b)=>(u(),m("div",{class:"des-item",key:b},[a("div",ze,d(o.diskNo||"-")+"\u76D8"+d(o.chipNo)+"\u82AF ",1),a("div",Ee,d(o.infrastructureInfo.type==="BOX"?"\u5149\u4EA4\u7BB1":o.infrastructureInfo.type==="ODF"?"odf\u67B6":o.infrastructureInfo.type==="TERMINAL"?"\u5149\u7EA4\u7EC8\u7AEF\u76D2":"\u7194\u63A5\u5305")+" \xA0"+d(o.infrastructureInfo.name),1)]))),128))]),a("div",Ne,[p(y,{type:"text",onClick:e[8]||(e[8]=o=>n.toDetail(s.infrastructureInfo))},{default:f(()=>[v("\u67E5\u770B\u8BE6\u60C5 "),p(_)]),_:1})])],512),[[T,s.detailVisible]]),S(a("div",{class:"dragend-box",style:L({left:s.dragendL,top:s.dragendT})},[a("span",Ue,[v("\u79FB\u52A8\u8BBE\u65BD "),p(y,{type:"primary",size:"small",onClick:n.saveDragend},{default:f(()=>[v("\u4FDD\u5B58")]),_:1},8,["onClick"])]),a("span",je,"\u7ECF\u5EA6\uFF1A"+d(s.dragendData.lng)+", \u7EAC\u5EA6\uFF1A"+d(s.dragendData.lat),1),a("span",Be,d(s.dragendData.addreesd),1)],4),[[T,s.dragendVisible]]),a("div",Pe,null,512)])]),_:1}),p(O,{visible:s.addVisible,"onUpdate:visible":e[9]||(e[9]=o=>s.addVisible=o),title:"\u6DFB\u52A0\u8BBE\u65BD",onOk:n.handleAddOk},{default:f(()=>[a("div",null,[a("span",null,"\u7ECF\u7EAC\u5EA6\uFF1A "+d(s.addAddressObj.lng)+" \xA0\xA0 "+d(s.addAddressObj.lat),1)]),a("p",null,d(s.addAddressObj.address),1)]),_:1},8,["visible","onOk"]),p(O,{visible:s.setVisible,"onUpdate:visible":e[10]||(e[10]=o=>s.setVisible=o),title:"\u8BBE\u7F6E\u4FE1\u606F",width:"100%","wrap-class-name":"full-modal",onOk:n.handleSetClose,onCancel:e[11]||(e[11]=o=>n.handleSetClose("cancel")),destroyOnClose:!0},{default:f(()=>[s.hackReset?(u(),A(V,{key:0,actionType:"add",addAddressObj:s.addAddressObj,onCloseDialog:n.handleClose},null,8,["addAddressObj","onCloseDialog"])):C("",!0)]),_:1},8,["visible","onOk"])])}const We=R(ee,[["render",Ge],["__scopeId","data-v-150985b1"]]);export{We as default};
