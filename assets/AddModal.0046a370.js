import{r as d,o as U,i as B,w as s,d as l,e as c,f as M,g as P,m as f,a6 as I,n as R,B as q,aJ as S,ac as V,s as A,M as L}from"./index.192c8708.js";import{u as O}from"./qualityReport.6dc17b5d.js";import{b as j}from"./artMag.f64bd10b.js";import{U as E}from"./UploadOutlined.4d52294f.js";const H={__name:"AddModal",emits:["refresh"],setup(J,{expose:_,emit:g}){const h=g,i=d(!1),m=d(),t=d({templateName:"",filename:"",fileInfo:"",remark:""}),o=d([]),b={templateName:[{required:!0,message:"\u8BF7\u8F93\u5165\u8303\u672C\u540D\u79F0",trigger:"change"}],templateFiles:[{required:!0,validator:(a,e,r)=>o.value.length===0?Promise.reject("\u8BF7\u9009\u62E9\u9700\u8981\u4E0A\u4F20\u7684\u6587\u4EF6"):Promise.resolve(),trigger:"change"}]},k=a=>{console.log(a),O({file:a.file}).then(e=>{f.success("\u4E0A\u4F20\u6210\u529F"),console.log("\u4E0A\u4F20\u6210\u529F",e.data),o.value[o.value.length-1].fileInfo=e.data,console.log(o.value,"test"),a.onSuccess(e.data,a)}).catch(e=>{a.onError(e)})},C=a=>{i.value=!0},F=()=>{m.value.validate().then(a=>{var e,r;if(a)try{t.value.filename=((e=o.value[0])==null?void 0:e.name)||"",t.value.fileInfo=((r=o.value[0])==null?void 0:r.response)||"",j(t.value).then(n=>{n.code===200&&(m.value.resetFields(),t.value={},o.value=[],f.success("\u63D0\u4EA4\u6210\u529F"),i.value=!1,h("refresh"))})}catch{}else return f.error("\u63D0\u4EA4\u5931\u8D25\uFF0C\u8BF7\u586B\u5199\u5FC5\u586B\u9879"),!1})},v=()=>{m.value.resetFields(),t.value={},o.value=[],i.value=!1};return _({showModal:C}),(a,e)=>{const r=I,n=R,p=q,w=S,x=V,y=A,N=L;return U(),B(N,{visible:i.value,title:"\u65B0\u589E",onCancel:v,maskClosable:!1,"append-to-body":"",destroyOnClose:""},{footer:s(()=>[l(p,{onClick:v},{default:s(()=>[c("\u53D6\u6D88")]),_:1}),l(p,{type:"primary",onClick:e[3]||(e[3]=u=>F())},{default:s(()=>[c("\u63D0\u4EA4")]),_:1})]),default:s(()=>[M("div",null,[l(y,{"label-col":{span:6},ref_key:"formRef",ref:m,model:t.value,rules:b},{default:s(()=>[l(n,{label:"\u8303\u672C\u540D\u79F0",name:"templateName"},{default:s(()=>[l(r,{value:t.value.templateName,"onUpdate:value":e[0]||(e[0]=u=>t.value.templateName=u),placeholder:"\u8BF7\u8F93\u5165\u8303\u672C\u540D\u79F0",style:{width:"250px"}},null,8,["value"])]),_:1}),l(n,{label:"\u8303\u672C\u6587\u4EF6",prop:"templateFiles"},{default:s(()=>[l(w,{name:"templateFiles","file-list":o.value,"onUpdate:fileList":e[1]||(e[1]=u=>o.value=u),maxCount:1,customRequest:k,onPreview:a.handlePreview},{default:s(()=>[l(p,{class:"upload-button"},{default:s(()=>[l(P(E)),c("\u70B9\u51FB\u4E0A\u4F20")]),_:1})]),_:1},8,["file-list","onPreview"])]),_:1}),l(n,{label:"\u8303\u672C\u8BF4\u660E"},{default:s(()=>[l(x,{value:t.value.remark,"onUpdate:value":e[2]||(e[2]=u=>t.value.remark=u),placeholder:"\u8BF7\u8F93\u5165\u8303\u672C\u8BF4\u660E",style:{width:"250px"}},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible"])}}};export{H as default};
