import{z as Je,r as s,A,bV as et,at as B,V as tt,o as d,c as k,d as u,w as o,e as _,t as y,f as I,g as p,i as v,Q as w,b6 as at,W as ne,F as V,m as z,_ as nt,a3 as lt,n as ot,l as ut,B as rt,s as st,q as dt,a6 as ct,b3 as it,bW as pt,a9 as vt,bX as ft,bY as mt,bZ as _t,b_ as yt,x as ht,p as gt,b$ as bt,a4 as kt,M as It,N as St,O as wt,G as xt}from"./index.192c8708.js";import{p as Rt,s as le,O as Nt,c as Ct,a as Ut,b as jt,D as Dt,d as $t}from"./newPurchase.bb088d76.js";const oe=[{title:"\u5E8F\u53F7",dataIndex:"key",key:"key",align:"center",width:50,scopedSlots:{customRender:(x,P,Q)=>`${Q+1}`}},{title:"\u5546\u54C1\u7F16\u7801",dataIndex:"productCode",width:150,ellipsis:!0,key:"productCode",scopedSlots:{customRender:"productCode"},slots:{customRender:"productCode"}},{title:"\u5546\u54C1\u540D\u79F0",dataIndex:"productName",width:180,ellipsis:!0,key:"productName",scopedSlots:{customRender:"productName"},slots:{customRender:"productName"}},{title:"\u89C4\u683C\u578B\u53F7",dataIndex:"productSpec",width:150,ellipsis:!0,scopedSlots:{customRender:"productSpec"},slots:{customRender:"productSpec"}},{title:"\u5305\u6570",dataIndex:"everbag",width:150},{title:"\u8BA2\u8D27\u6570\u91CF",dataIndex:"orderQuality",width:150,ellipsis:!0,scopedSlots:{customRender:"orderQuality"},slots:{customRender:"orderQuality"},summary:!0,type:"orderQuality"},{title:"\u8BA1\u91CF\u5355\u4F4D",dataIndex:"measureUnit",width:150,ellipsis:!0,scopedSlots:{customRender:"measureUnit"},slots:{customRender:"measureUnit"}},{title:"\u57FA\u672C\u8BA1\u91CF\u5355\u4F4D\u6570\u91CF",dataIndex:"jbjsdwsl",width:150,ellipsis:!0,scopedSlots:{customRender:"jbjsdwsl"},slots:{customRender:"jbjsdwsl"},summary:!0,type:"jbjsdwsl"},{title:"\u57FA\u672C\u8BA1\u91CF\u5355\u4F4D",dataIndex:"baseMeasureUnit",width:150,ellipsis:!0,scopedSlots:{customRender:"baseMeasureUnit"},slots:{customRender:"baseMeasureUnit"}},{title:"\u542B\u7A0E\u5355\u4EF7(\u5143)",dataIndex:"unitPrice",width:150,ellipsis:!0,scopedSlots:{customRender:"unitPrice"},slots:{customRender:"unitPrice"}},{title:"\u542B\u7A0E\u5408\u8BA1(\u5143)",dataIndex:"hshj",width:150,ellipsis:!0,scopedSlots:{customRender:"hshj"},slots:{customRender:"hshj"},summary:!0,type:"hshj"},{title:"\u7CAE\u98DF\u6027\u8D28",dataIndex:"nature",width:150,ellipsis:!0,scopedSlots:{customRender:"nature"},slots:{customRender:"nature"}},{title:"\u5408\u4F5C\u5BA2\u6237",dataIndex:"cooperatorId",width:150,ellipsis:!0,scopedSlots:{customRender:"cooperatorId"},slots:{customRender:"cooperatorId"}},{title:"\u6536\u8D27\u4ED3\u5E93",dataIndex:"receiveStorehouse",width:150,ellipsis:!0,scopedSlots:{customRender:"receiveStorehouse"},slots:{customRender:"receiveStorehouse"}},{title:"\u4EA4\u8D27\u65E5\u671F",dataIndex:"deliveryDate",width:260,ellipsis:!0,scopedSlots:{customRender:"deliveryDate"},slots:{customRender:"deliveryDate"}},{title:"\u8BA2\u5355\u65E5\u671F",dataIndex:"orderDate",width:150,ellipsis:!0,scopedSlots:{customRender:"orderDate"},slots:{customRender:"orderDate"}},{title:"\u5907\u6CE8",dataIndex:"remark",width:150,ellipsis:!0,scopedSlots:{customRender:"remark"},slots:{customRender:"remark"}}];const T=x=>(St("data-v-076eb31b"),x=x(),wt(),x),Tt=T(()=>I("span",{class:"separate"},"/",-1)),Pt=T(()=>I("span",null,"\u5BA1\u6279\u5217\u8868",-1)),Qt={class:"app-container"},Et={class:"container-wrapper"},Lt={key:0},qt={key:5},Mt={key:6},Kt={key:7},Ot=T(()=>I("div",null,[I("span",null,"\u5546\u54C1\u5206\u7C7B")],-1)),Ft={class:"head-container"},At={key:1,style:{"text-align":"center"}},Bt=T(()=>I("span",null,"\u6682\u65E0\u6570\u636E",-1)),Vt=[Bt],zt={__name:"index",setup(x){const{proxy:P}=xt(),Q=s("\u5546\u54C1\u4FE1\u606F"),j=s(!1),ue=s([{value:1,label:"\u5B9A\u5411\u8D2D\u9500"},{value:2,label:"\u81EA\u4E3B\u7ECF\u8425"}]),re=s([{value:1,label:"\u4EBA\u6C11\u5E01"},{value:2,label:"\u7F8E\u5143"}]),R=s([]);s([{value:1,label:"\u5408\u4F5C\u8F6C\u6362"},{value:2,label:"\u81EA\u4E3B\u8F6C\u6362"}]);const g=s(void 0),se=s([{title:"\u7269\u6599\u7F16\u7801",dataIndex:"id",ellipsis:!0,scopedSlots:{customRender:"id"},slots:{customRender:"id"}},{title:"\u7269\u6599\u540D\u79F0",dataIndex:"productName",ellipsis:!0,scopedSlots:{customRender:"productName"},slots:{customRender:"productName"}},{title:"\u89C4\u683C\u578B\u53F7",dataIndex:"specName",ellipsis:!0,scopedSlots:{customRender:"specName"},slots:{customRender:"specName"}},{title:"\u57FA\u672C\u8BA1\u91CF\u5355\u4F4D",dataIndex:"measurementUnit",ellipsis:!0}]),D=s([]),G=s([]),de=s(!0);function ce(e,t){if(g.value=void 0,e.length!=0){let a;t.node.ctgLevel==1?a={ctgLevel1Id:e[0]}:a={ctgLevel2Id:e[0]},console.log(a,t.node.ctgLevel,e,"xxx"),Rt(a).then(r=>{let h=r==null?void 0:r.data;g.value=h})}}const ie=e=>{G.value=e,de.value=!1},pe=["productCode","productName","productSpec","orderQuality","measureUnit","jbjsdwsl","baseMeasureUnit","unitPrice","hshj","nature","cooperatorId","receiveStorehouse","deliveryDate","orderDate","remark"],ve=["deliveryDate"],fe=[""],me=["orderQuality","unitPrice","remark"],_e=["measureUnit","nature","cooperatorId","receiveStorehouse"],N=s([]),l=s([{key:1,orderQuality:void 0,unitPrice:void 0,remark:void 0,productName:void 0,measureUnit:3,cooperatorId:void 0,receiveStorehouse:void 0,deliveryDate:void 0,orderDate:void 0,editable:!0}]);s(!0);const W=s(),ye=A({queryParams:{orderType:void 0,supplierId:void 0,contractNo:void 0,currency:void 0},rules:{orderType:[{required:!0,message:"\u5FC5\u9009",trigger:["change"]}],supplierId:[{required:!0,message:"\u5FC5\u9009",trigger:["change"]}],contractNo:[{required:!0,message:"\u5FC5\u586B",trigger:"blur"}]}});function Gt(e,t){}const he=et(e=>{console.log("fetching user",e),R.value=[],le({supplierName:e}).then(t=>{t.data.forEach(a=>{R.value.push({value:a.id,label:a.supplierName})})})},300),ge=async(e,t)=>(await $t(e)).data;function E(e,t){if(l.value[e].orderQuality&&l.value[e].measureUnit&&l.value[e].unitPrice&&l.value[e].baseMeasureUnit){let a={orderQuality:l.value[e].orderQuality,measureUnit:l.value[e].measureUnit,baseMeasureUnit:l.value[e].baseMeasureUnit,unitPrice:l.value[e].unitPrice};ge(a).then(h=>{l.value[e].jbjsdwsl=h.baseQuality,l.value[e].hshj=h.totalPrice})}}function be(){P.resetForm("queryRef"),l.value=[{key:1,orderQuality:void 0,unitPrice:void 0,remark:void 0,productName:void 0,measureUnit:3,cooperatorId:void 0,receiveStorehouse:void 0,deliveryDate:void 0,editable:!0}]}async function X(e){await W.value.validateFields(),l.value.forEach((a,r)=>{a.orderType=c.value.orderType,a.supplierId=c.value.supplierId,a.contractNo=c.value.contractNo,a.currency=c.value.currency,a.isDraft=e});const t=l.value.map((a,r)=>(a.deliveryDateEnd=a.deliveryDate[1],a.deliveryDate=a.deliveryDate[0],a));Nt(t).then(a=>{a.code==200&&(e==0&&(P.resetForm("queryRef"),l.value=[{key:1,orderQuality:void 0,unitPrice:void 0,remark:void 0,productName:void 0,measureUnit:3,cooperatorId:void 0,receiveStorehouse:void 0,deliveryDate:void 0,editable:!0}]),z.success("\u4FDD\u5B58\u6210\u529F"))})}const L=s(0),ke=B(()=>(L.value=0,l.value.forEach((e,t)=>{e.hshj&&(L.value+=Number(e.hshj))}),L.value)),q=s(0),Ie=B(()=>(q.value=0,l.value.forEach((e,t)=>{e.orderQuality&&(q.value+=Number(e.orderQuality))}),q.value)),M=s(0),Se=B(()=>(M.value=0,l.value.forEach((e,t)=>{console.log(e.jbjsdwsl,"xxxxx"),e.jbjsdwsl&&(M.value+=Number(e.jbjsdwsl))}),M.value)),S=s(void 0);function we(e){S.value=e,qe(),j.value=!0}function xe(e){if(e=="measureUnit")return[{value:1,label:"\u65A4"},{value:2,label:"\u516C\u65A4/\u5343\u514B"},{value:3,label:"\u5428"}];if(e=="nature")return[{value:1,label:"\u50A8\u5907\u7CAE"},{value:2,label:"\u5546\u54C1\u7CAE"},{value:3,label:"\u8F6E\u6362\u7CAE\u6CB9"}];if(e=="cooperatorId")return Y.value;if(e=="receiveStorehouse")return Z.value}function Re(e,t,a){console.log(t,"col",e),t=="unitPrice"?(e!==""&&e.substr(0,1)==="."&&(e=""),e=e.replace(/^0*(0\.|[1-9])/,"$1"),console.log(e,"value1"),e=e.replace(/[^\d.]/g,""),console.log(e,"value2"),e=e.replace(/\.{2,}/g,"."),console.log(e,"value3"),e=e.replace(".","$#$").replace(/\./g,"").replace("$#$","."),console.log(e,"value4"),e=e.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),console.log(e,"value5"),e.indexOf(".")<0&&e!==""&&e.substr(0,1)==="0"&&e.length===2&&(e=e.substr(1,e.length)),l.value[a][t]=e):(t=="orderQuality"&&(e=e.replace(/^0*(0\.|[1-9])/,"$1"),e=e.replace(/[^\d.]/g,""),e=e.replace(/(\d*\.\d{0,3}).*/,"$1")),l.value[a][t]=e),e==""&&(l.value[a].jbjsdwsl=null,l.value[a].hshj=null),(t=="orderQuality"||t=="unitPrice")&&E(a)}function Ne(e,t,a){console.log(l.value[a][t],"$event")}function Ce(e,t,a){l.value[a][t]=e}const Ue=e=>{l.value.forEach((t,a)=>{l.value[a].currency=e})},je=A({onChange:(e,t)=>{N.value=[],N.value=t.map(a=>a.key),console.log(`selectedRowKeys: ${e}`,"selectedRows: ",t,N.value)}}),$=s(""),De=A({type:"radio",onChange:(e,t)=>{$.value=e}}),$e=()=>{if($.value!==""&&$.value!==null){let e=$.value;l.value[S.value].productName=g.value[e].productName,l.value[S.value].productCode=g.value[e].productId,l.value[S.value].productId=g.value[e].productId,l.value[S.value].productSpec=g.value[e].specName,l.value[S.value].productSpecId=g.value[e].id,l.value[S.value].baseMeasureUnit=g.value[e].measurementUnit,E(S.value),j.value=!1}else z.error("\u8BF7\u9009\u62E9\u89C4\u683C")};function Te(){let e={key:l.value.length+1,orderQuality:void 0,unitPrice:void 0,remark:void 0,productName:void 0,measureUnit:void 0,cooperatorId:void 0,receiveStorehouse:void 0,deliveryDate:void 0,editable:!0};l.value.push(e)}function Pe(){N.value.length!=0?N.value.forEach((e,t)=>{l.value.forEach((a,r)=>{e==a.key&&l.value.splice(r,1)})}):z.error("\u8BF7\u52FE\u9009\u4E00\u9879"),console.log(l.value,"x")}const Qe=e=>{if(e.length<1)return[];function t(a){a.map(r=>{r.key=r.id,r.title=r.ctgName,r.children&&r.children.length&&t(r.children)})}return t(e),e},Y=s([]);function Ee(){Ct().then(e=>{(e==null?void 0:e.data).forEach(a=>{Y.value.push({value:a.id,label:a.cooperatorName})})})}const Z=s([]);function Le(){Ut().then(e=>{(e==null?void 0:e.data).forEach(a=>{Z.value.push({value:a.id,label:a.storeName})})})}function qe(){jt().then(e=>{const t=(e==null?void 0:e.data)||[],a=Qe(t);console.log(a),D.value=a,H(t)})}const Me=[],H=e=>{if(!!e)for(let t=0;t<e.length;t++){const a=e[t],r=a.key;Me.push({key:r,title:a.title}),a.children&&H(a.children)}},Ke=()=>{le().then(e=>{e.data.forEach(t=>{R.value.push({value:t.id,label:t.supplierName})})})},Oe=()=>{Dt().then(e=>{e.data.length!=0&&(l.value=e.data,c.value.orderType=e.data[0].orderType,c.value.supplierId=e.data[0].supplierId,c.value.contractNo=e.data[0].contractNo,c.value.currency=e.data[0].currency,e.data.forEach((t,a)=>{E(a),l.value[a].key=a+1,l.value[a].editable=!0}))})},{queryParams:c,rules:Fe}=tt(ye);return Ee(),Le(),Ke(),Oe(),(e,t)=>{const a=nt,r=lt,h=ot,Ae=ut,C=rt,Be=st,K=dt,J=ct,Ve=it,ze=pt,Ge=vt,ee=ft,O=mt,We=_t,Xe=yt,te=ht,U=gt,Ye=bt,ae=kt,Ze=It;return d(),k(V,null,[u(a,{title:"\u65B0\u589E\u91C7\u8D2D\u8BA2\u5355",icon:"icon-rongqi"},{nav:o(()=>[_(y("\u91C7\u96C6\u7BA1\u7406")+" "),Tt,Pt]),_:1}),I("div",Qt,[u(K,{justify:"space-between",style:{flex:"1"}},{default:o(()=>[I("div",Et,[u(Be,{layout:"inline",ref_key:"queryRef",ref:W,rules:p(Fe),model:p(c)},{default:o(()=>[u(h,{label:"",name:"orderType"},{default:o(()=>[u(r,{label:"\u8BA2\u5355\u7C7B\u578B",placeholder:"\u8BF7\u9009\u62E9",style:{width:"240px"},clearable:"",value:p(c).orderType,"onUpdate:value":t[0]||(t[0]=n=>p(c).orderType=n),options:ue.value,onChange:t[1]||(t[1]=n=>void 0)},null,8,["value","options"])]),_:1}),R.value?(d(),v(h,{key:0,name:"supplierId"},{default:o(()=>[u(r,{label:"\u4F9B\u5E94\u5546",placeholder:"\u8BF7\u9009\u62E9",style:{"min-width":"240px"},value:p(c).supplierId,"onUpdate:value":t[2]||(t[2]=n=>p(c).supplierId=n),"show-search":"","filter-option":!1,options:R.value,onChange:t[3]||(t[3]=n=>void 0),onSearch:p(he)},null,8,["value","options","onSearch"])]),_:1})):w("",!0),u(h,{name:"contractNo"},{default:o(()=>[u(Ae,{label:"\u91C7\u8D2D\u5408\u540C\u53F7",placeholder:"\u8BF7\u8F93\u5165\u91C7\u8D2D\u5408\u540C\u53F7",value:p(c).contractNo,"onUpdate:value":t[4]||(t[4]=n=>p(c).contractNo=n),style:{width:"240px"},onkeyup:"this.value=this.value.replace(/[^u4e00-u9fa5w\\/-]/g,'')"},null,8,["value"])]),_:1}),u(h,{name:"currency"},{default:o(()=>[u(r,{label:"\u5E01\u522B",placeholder:"\u4EBA\u6C11\u5E01",style:{"min-width":"240px"},value:p(c).currency,"onUpdate:value":t[5]||(t[5]=n=>p(c).currency=n),"show-search":"","filter-option":!1,options:re.value,onChange:t[6]||(t[6]=n=>Ue(n))},null,8,["value","options"])]),_:1}),u(h,null,{default:o(()=>[u(C,{type:"primary",onClick:Te},{default:o(()=>[_("\u65B0\u589E")]),_:1}),u(C,{type:"primary",onClick:Pe,style:{"margin-left":"15px"}},{default:o(()=>[_("\u5220\u9664")]),_:1})]),_:1})]),_:1},8,["rules","model"])])]),_:1}),u(te,{scroll:{x:"max-content",y:240},columns:p(oe),"data-source":l.value,bordered:"",size:"small","row-Selection":je,rowKey:n=>n.key,summary:!0},at({bodyCell:o(({column:n,record:f,index:b})=>[n.dataIndex==="everbag"?(d(),k("div",Lt,y(f.orderQuality/parseInt(f.productSpec)*{1:.5,2:1,3:1e3}[l.value[b].measureUnit]||""),1)):w("",!0)]),summary:o(()=>[u(Xe,{fixed:""},{default:o(()=>[u(We,null,{default:o(()=>[u(ee,{index:0},{default:o(()=>[_(" \u5408\u8BA1")]),_:1}),(d(!0),k(V,null,ne(p(oe),(n,f)=>(d(),v(ee,{key:f,index:1},{default:o(()=>[n!=null&&n.summary?(d(),k(V,{key:0},[n.type=="orderQuality"?(d(),v(O,{key:0},{default:o(()=>[_(y(Ie.value),1)]),_:1})):w("",!0),n.type=="jbjsdwsl"?(d(),v(O,{key:1},{default:o(()=>[_(y(Se.value),1)]),_:1})):w("",!0),n.type=="hshj"?(d(),v(O,{key:2},{default:o(()=>[_(y(ke.value),1)]),_:1})):w("",!0)],64)):w("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:2},[ne(pe,n=>({name:n,fn:o(({column:f,record:b,index:i,text:F,value:Wt})=>[(d(),k("div",{key:n},[b.editable&&me.includes(n)?(d(),v(J,{key:0,"read-only":fe.includes(n),placeholder:"\u8BF7\u8F93\u5165",value:F,onChange:m=>Re(m.target.value,n,i)},null,8,["read-only","value","onChange"])):b.editable&&ve.includes(n)?(d(),v(Ve,{key:1,placeholder:"\u8BF7\u9009\u62E9\u65F6\u95F4",onChange:m=>Ne(m,n,i),value:l.value[i][n],"onUpdate:value":m=>l.value[i][n]=m},null,8,["onChange","value","onUpdate:value"])):b.editable&&["orderDate"].includes(n)?(d(),v(ze,{key:2,placeholder:"\u8BF7\u9009\u62E9\u65F6\u95F4",value:l.value[i][n],"onUpdate:value":m=>l.value[i][n]=m},null,8,["value","onUpdate:value"])):b.editable&&_e.includes(n)?(d(),v(Ge,{key:3,placeholder:"\u8BF7\u9009\u62E9",style:{display:"block"},value:F,options:xe(n),"show-search":"","filter-option":(m,He)=>He.label.indexOf(m)>=0,onChange:m=>Ce(m,n,i)},null,8,["value","options","filter-option","onChange"])):b.editable&&n=="productName"?(d(),v(J,{key:4,"read-only":"true",placeholder:"\u8BF7\u70B9\u51FB\u9009\u62E9",value:F,onClick:m=>we(i)},null,8,["value","onClick"])):b.editable&&n=="baseMeasureUnit"?(d(),k("span",qt,y(l.value[i][n]==null?"\u81EA\u52A8\u5E26\u51FA":l.value[i][n]==1?"\u65A4":l.value[i][n]==2?"\u516C\u65A4":"\u5428"),1)):b.editable&&n=="measureUnit"?(d(),k("span",Mt,y("\u5428"))):(d(),k("span",Kt,y(l.value[i][n]==null?"\u81EA\u52A8\u5E26\u51FA":l.value[i][n]),1))]))])}))]),1032,["columns","data-source","row-Selection","rowKey"]),u(K,null,{default:o(()=>[u(U,{span:10,style:{"text-align":"center"}},{default:o(()=>[u(C,{type:"primary",onClick:t[7]||(t[7]=n=>X(1))},{default:o(()=>[_("\u4FDD\u5B58\u8349\u7A3F")]),_:1})]),_:1}),u(U,{span:4,style:{"text-align":"center"}},{default:o(()=>[u(C,{type:"primary",onClick:be},{default:o(()=>[_("\u6E05\u7A7A\u6570\u636E")]),_:1})]),_:1}),u(U,{span:10,style:{"text-align":"center"}},{default:o(()=>[u(C,{type:"primary",onClick:t[8]||(t[8]=n=>X(0))},{default:o(()=>[_("\u63D0\u4EA4\u8BA2\u5355")]),_:1})]),_:1})]),_:1})]),u(Ze,{title:Q.value,visible:j.value,"onUpdate:visible":t[9]||(t[9]=n=>j.value=n),width:"800px",onOk:$e},{default:o(()=>[u(K,{gutter:24},{default:o(()=>[u(U,{span:8},{default:o(()=>[Ot,I("div",Ft,[D.value&&D.value.length>0?(d(),v(Ye,{key:0,"tree-data":D.value,"field-names":{key:"id",title:"label",children:"children"},"expand-on-click-node":!1,ref:"deptTreeRef",defaultExpandAll:"",onSelect:ce,onExpand:ie,expandedKeys:G.value,showLine:""},{title:o(({title:n})=>[I("span",null,y(n),1)]),_:1},8,["tree-data","expandedKeys"])):(d(),k("div",At,Vt))])]),_:1}),u(U,{span:16},{default:o(()=>[u(te,{dataSource:g.value,columns:se.value,pagination:!1,style:{"margin-left":"0px"},"row-Selection":De,rowKey:(n,f)=>f,class:"productTable"},{bodyCell:o(({column:n,record:f})=>[n.dataIndex==="measurementUnit"?(d(),v(ae,{key:0},{default:o(()=>[_(y(f.measurementUnit==1?"\u65A4":f.measurementUnit==2?"\u516C\u65A4":"\u5428"),1)]),_:2},1024)):w("",!0),n.dataIndex==="nature"?(d(),v(ae,{key:1},{default:o(()=>[_(y(f.nature=="1"?"\u50A8\u5907\u7CAE":f.nature=="2"?"\u5546\u54C1\u7CAE":"\u8F6E\u6362\u7CAE\u6CB9"),1)]),_:2},1024)):w("",!0)]),_:1},8,["dataSource","columns","row-Selection","rowKey"])]),_:1})]),_:1})]),_:1},8,["title","visible"])],64)}}},Zt=Je(zt,[["__scopeId","data-v-076eb31b"]]);export{Zt as default};
