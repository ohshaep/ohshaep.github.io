(window.webpackJsonp=window.webpackJsonp||[]).push([["keySite"],{"82f8d":function(e,t,r){"use strict";r.r(t);var a=r("c7eb"),o=r("1da1"),l=r("0c6d");function i(e){return Object(l.a)({url:"/api/workOrderManagement/findAll",method:"get",params:e})}function n(e){return Object(l.a)({url:"/api/workOrderManagement/edit",method:"post",data:e})}r("e9c4"),r("b64b");var s={data:function(){return{dialogVisible:!1,openreason:"close"}},methods:{handleClose:function(e){e()},open:function(e){this.orderDetail=JSON.parse(JSON.stringify(e)),this.openreason=e.type,this.dialogVisible=!0},cancel:function(){this.dialogVisible=!1},confirm:function(){var e=this;return Object(o.a)(Object(a.a)().mark((function t(){return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.dialogVisible=!1,"close"!==e.openreason){t.next=13;break}return t.prev=2,t.next=5,n({id:e.orderDetail.id,status:2});case 5:e.$message.success("关闭工单成功"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),e.$message.error("关闭工单失败");case 11:t.next=22;break;case 13:return t.prev=13,t.next=16,n({id:e.orderDetail.id,status:3});case 16:e.$message.success("删除工单成功"),t.next=22;break;case 19:t.prev=19,t.t1=t.catch(13),e.$message.error("删除工单失败");case 22:e.$emit("reload");case 23:case"end":return t.stop()}}),t,null,[[2,8],[13,19]])})))()}}},c=r("2877"),u=Object(c.a)(s,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"工单",visible:e.dialogVisible,width:"30%","before-close":e.handleClose,"destroy-on-close":""},on:{"update:visible":function(t){e.dialogVisible=t}}},["close"===e.openreason?t("span",[e._v("你确定关闭该工单吗？关闭后工单将无法再添加跟进！")]):t("span",[e._v("你确定要删除工单吗？删除工单信息，跟进记录信息，以及附件信息将无法查看")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)])}),[],!1,null,null,null).exports,d={data:function(){return{dialogVisible:!1,ruleForm:{projectName:"",remark:""},rules:{projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}]}}},methods:{handleClose:function(){this.resetForm(),this.dialogVisible=!1},open:function(e){if(null!=e&&e.id){var t=e.projectName,r=e.remark,a=e.id;this.ruleForm={projectName:t,remark:r,id:a}}this.dialogVisible=!0},confirm:function(){var e=this;return Object(o.a)(Object(a.a)().mark((function t(){return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.ruleForm.id){t.next=14;break}return t.prev=1,t.next=4,n(e.ruleForm);case 4:e.$message.success("修改工单成功"),e.success(),e.resetForm(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),e.$message.error("修改工单失败");case 12:t.next=24;break;case 14:return t.prev=14,t.next=17,r=Object.assign(e.ruleForm,{status:1}),Object(l.a)({url:"/api/workOrderManagement/add",method:"post",data:r});case 17:e.$message.success("新增工单成功"),e.success(),t.next=24;break;case 21:t.prev=21,t.t1=t.catch(14),e.$message.error("新增工单失败");case 24:case"end":return t.stop()}var r}),t,null,[[1,9],[14,21]])})))()},resetForm:function(){this.$refs.ruleForm.resetFields(),this.ruleForm={projectName:"",remark:""}},success:function(){this.$emit("reload"),this.dialogVisible=!1}}},p=Object(c.a)(d,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"新增工单",visible:e.dialogVisible,width:"40%","before-close":e.handleClose,"destroy-on-close":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"ruleForm",attrs:{inline:!0,model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"项目名称",prop:"projectName"}},[t("el-input",{model:{value:e.ruleForm.projectName,callback:function(t){e.$set(e.ruleForm,"projectName",t)},expression:"ruleForm.projectName"}})],1),t("el-form-item",{attrs:{label:"项目备注",prop:"remark"}},[t("el-input",{model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)}),[],!1,null,null,null).exports,m=(r("b0c0"),r("d81d"),r("14d9"),r("a434"),r("ac1f"),r("466d"),r("365c")),f={data:function(){return{dialogVisible:!1,ruleForm:[{name:"",url:"",fileType:"image",fileList:[],key:(new Date).getTime()}],rules:{name:[{required:!0,message:"请输入文件名称",trigger:"blur"}]}}},computed:{uploadUrl:function(){return m.qb.uploadPictureUrl}},methods:{handleClose:function(){this.resetForm(),this.dialogVisible=!1},open:function(e){this.orderId=e.id;var t=JSON.parse(e.fileList);(null==t?void 0:t.length)>0&&(this.ruleForm=t.map((function(e){return{name:e.name,url:e.url,fileList:[{name:e.name,url:e.url}],key:(new Date).getTime()}}))),this.dialogVisible=!0},confirm:function(){var e=this;return Object(o.a)(Object(a.a)().mark((function t(){var r,o;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.ruleForm.map((function(e){return{name:e.name,url:e.url,fileType:e.fileType}})),o={fileList:JSON.stringify(r),id:e.orderId},t.prev=4,t.next=7,n(o);case 7:e.$message.success("新增文件成功"),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(4),e.$message.error("新增文件失败");case 13:e.$emit("reload"),e.handleClose();case 15:case"end":return t.stop()}}),t,null,[[4,10]])})))()},resetForm:function(){this.ruleForm=[{name:"",url:"",fileList:[],fileType:"image",key:(new Date).getTime()}]},addformItem:function(){var e=this;this.ruleForm.push({name:"",url:"",fileList:[],fileType:"image",key:(new Date).getTime()}),this.$nextTick((function(){var t=e.$refs.containerRef;t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}))},deleteFormItem:function(e){this.ruleForm.splice(e,1)},handleExceed:function(e){this.$message.warning("当前限制每次选择 个文件，本次选择了 ".concat(e.length," 个文件"))},handlePreview:function(e,t){window.open(this.ruleForm[t].url,"_blank")},handleRemove:function(e){},beforeRemove:function(e,t,r){this.ruleForm[r].url=""},sucessAfter:function(e,t,r,a){var o=t.name.match(/\.(pdf|PDF)$/);this.ruleForm[a].fileType=o?"pdf":"image",this.ruleForm[a].url=e.data}}},b=(r("fb1d"),Object(c.a)(f,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"文件",visible:e.dialogVisible,width:"50%","before-close":e.handleClose,"destroy-on-close":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{ref:"containerRef",staticClass:"container"},e._l(e.ruleForm,(function(r,a){return t("div",{key:a},[t("el-form",{ref:"ruleForm",refInFor:!0,attrs:{inline:!0,model:r,"status-icon":"",rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"".concat("文件名称"+(a+1)),prop:"name"}},[t("el-input",{model:{value:r.name,callback:function(t){e.$set(r,"name",t)},expression:"formItem.name"}})],1),t("el-form-item",{staticStyle:{"text-align":"center"}},[t("el-upload",{staticClass:"upload-demo",attrs:{action:e.uploadUrl,"on-preview":function(t){return e.handlePreview(t,a)},"on-remove":e.handleRemove,"before-remove":function(t,r){return e.beforeRemove(t,r,a)},multiple:"",accept:"image/*,.pdf,.PDF",limit:1,"on-exceed":e.handleExceed,"file-list":r.fileList,"on-success":function(t,r,o){return e.sucessAfter(t,r,o,a)}}},[t("el-button",{attrs:{type:"primary"}},[e._v("上传"),t("i",{staticClass:"el-icon-upload el-icon--right"})])],1),t("div",{staticClass:"el-upload__tip"},[e._v("只能上传图片或者PDF文件")])],1),t("el-form-item",[e.ruleForm.length===a+1?t("el-button",{attrs:{type:"primary"},on:{click:e.addformItem}},[t("i",{staticClass:"el-icon-plus"}),e._v("添加文件")]):e._e(),e.ruleForm.length>1?t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.deleteFormItem(a)}}},[t("i",{staticClass:"el-icon-plus"}),e._v("删除")]):e._e()],1)],1)],1)})),0),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)])}),[],!1,null,"570a8c86",null).exports),h={data:function(){return{dialogVisible:!1,TableData:[],tableColumn:[{label:"跟进时间",props:"createTime",width:"180"},{label:"跟进人",props:"createBy",width:"180"},{label:"跟进备注",props:"remark",width:"180"}]}},methods:{handleClose:function(){this.resetForm(),this.dialogVisible=!1},open:function(e){var t=this;return Object(o.a)(Object(a.a)().mark((function r(){var o;return Object(a.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.dialogVisible=!0,r.prev=2,r.next=5,a=e.id,Object(l.a)({url:"/api/workOrderManagementFollow/queryById/".concat(a),method:"get"});case 5:o=r.sent,t.TableData=o.data,r.next=12;break;case 9:r.prev=9,r.t0=r.catch(2),t.$message.error("获取数据失败");case 12:case"end":return r.stop()}var a}),r,null,[[2,9]])})))()},resetForm:function(){},dateFormat:function(e,t){return"statusCollection"===t.property?1===e[t.property]?"未收款":2===e[t.property]?"部分收款":3===e[t.property]?"全部收款":"无":e[t.property]}}},g=Object(c.a)(h,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"跟进记录",visible:e.dialogVisible,width:"40%","before-close":e.handleClose,"destroy-on-close":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.TableData,border:"",fit:""}},[e._l(e.tableColumn,(function(r){return t("el-table-column",{key:r.id,attrs:{prop:r.props,label:r.label,"min-width":r.width,formatter:e.dateFormat}})})),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.loadFile(r.row)}}},[e._v("预览")])]}}])})],2)],1)}),[],!1,null,null,null).exports,v=r("5a0c"),y=r.n(v),k={components:{closeOrDelWorkOrderDialog:u,addWorkOrderDialog:p,uploadDialog:b,followRecordTableDialog:g},data:function(){return{tableColumn:[{id:1,props:"projectName",label:"项目名称",width:"50"},{id:2,props:"remark",label:"项目备注",width:"100"},{id:3,props:"createBy",label:"创建人",width:"50"},{id:4,props:"createTime",label:"创建日期",width:"50"},{id:5,props:"status",label:"工单状态",width:"50"},{id:6,props:"updateBy",label:"最新跟进人",width:"50"}],TableData:[],searchForm:{projectName:null,createTime:null,updateTime:null,status:null},currentPage:1,pageSize:10,pageCount:0}},created:function(){this.getList()},methods:{getList:function(){var e=this;return Object(o.a)(Object(a.a)().mark((function t(){var r,o,l;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$loading({lock:!0,text:"正在加载中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),o=Object.assign({pageIndex:e.currentPage,pageSize:e.pageSize},e.searchForm),t.next=4,i(o);case 4:"加载成功"===(l=t.sent).resultMsg?(e.TableData=l.data,e.pageCount=l.totalPages):(e.$message.error("加载数据失败"),r.close()),r.close();case 7:case"end":return t.stop()}}),t)})))()},resetSearch:function(){this.searchForm={projectName:null,createTime:null,updateTime:null,status:null},this.currentPage=1,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},sumitSearchForm:function(){this.currentPage=1,this.getList()},edit:function(e){"close"===e.type||"delete"===e.type?this.$refs.closeOrDelWorkOrderDialogRef.open(e):"add"===e.type?this.$refs.addWorkOrderDialogRef.open():"upload"===e.type?this.$refs.uploadDialogRef.open(e):"follow"===e.type?this.$refs.followRecordTableDialogRef.open(e):"edit"===e.type&&this.$refs.addWorkOrderDialogRef.open(e)},dateFormat:function(e,t){return"operateTime"===t.property?y()(e[t.property]).format("YYYY-MM-DD"):"status"===t.property?1===e[t.property]?"跟进中":2===e[t.property]?"已关闭":3===e[t.property]?"已删除":"状态错误":e[t.property]}}},F=(r("c7ae"),Object(c.a)(k,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("page-main",[t("g-page-lable",{scopedSlots:e._u([{key:"left",fn:function(){return[t("el-form",{attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{staticStyle:{"margin-left":"1px"}},[t("g-input-prepend",{attrs:{"prepend-title":"项目名称:",placeholder:"请填写项目名称"},model:{value:e.searchForm.projectName,callback:function(t){e.$set(e.searchForm,"projectName",t)},expression:"searchForm.projectName"}})],1),t("el-form-item",{staticStyle:{"margin-left":"1px"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择创建时间日期"},model:{value:e.searchForm.createTime,callback:function(t){e.$set(e.searchForm,"createTime",t)},expression:"searchForm.createTime"}})],1),t("el-form-item",{staticStyle:{"margin-left":"1px"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择跟进时间日期"},model:{value:e.searchForm.updateTime,callback:function(t){e.$set(e.searchForm,"updateTime",t)},expression:"searchForm.updateTime"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.sumitSearchForm}},[e._v("查询")])],1),t("el-form-item",[t("el-button",{on:{click:e.resetSearch}},[e._v("重置")])],1)],1)]},proxy:!0},{key:"right",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.edit({type:"add"})}}},[e._v("新增")])]},proxy:!0}])})],1),t("page-main",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.TableData,border:"",fit:""}},[e._l(e.tableColumn,(function(r){return t("el-table-column",{key:r.id,attrs:{prop:r.props,label:r.label,"min-width":r.width,formatter:e.dateFormat}})})),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(r){var a=r.row;return[3!==a.status?t("div",[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.edit(Object.assign(a,{type:"upload"}))}}},[e._v("上传文件")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.edit(Object.assign(a,{type:"follow"}))}}},[e._v("跟进记录")]),t("el-popover",{attrs:{placement:"left",trigger:"click"}},[t("el-button",{attrs:{type:"text",size:"small",disabled:2===a.status},on:{click:function(t){e.edit(Object.assign(a,{type:"close"}))}}},[e._v("关闭工单")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.edit(Object.assign(a,{type:"edit"}))}}},[e._v("修改")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.edit(Object.assign(a,{type:"delete"}))}}},[e._v("删除")]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[t("i",{staticClass:"el-icon-more"})])],1)],1):e._e()]}}])})],2),t("div",{staticClass:"pagenation"},[t("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":e.pageSize,layout:"total,prev, pager, next, jumper","page-count":e.pageCount},on:{"current-change":e.handleCurrentChange}})],1),t("closeOrDelWorkOrderDialog",{ref:"closeOrDelWorkOrderDialogRef",on:{reload:e.getList}}),t("addWorkOrderDialog",{ref:"addWorkOrderDialogRef",on:{reload:e.getList}}),t("uploadDialog",{ref:"uploadDialogRef",on:{reload:e.getList}}),t("followRecordTableDialog",{ref:"followRecordTableDialogRef"})],1)],1)}),[],!1,null,"4d5190e9",null));t.default=F.exports},"8e8c":function(e,t,r){},bd60:function(e,t,r){},c7ae:function(e,t,r){"use strict";r("8e8c")},e0fe:function(e,t,r){"use strict";r.r(t);var a=r("2877"),o=Object(a.a)({},(function(){return(0,this._self._c)("div",[this._v("重点工地工单跟进记录")])}),[],!1,null,null,null);t.default=o.exports},fb1d:function(e,t,r){"use strict";r("bd60")}}]);